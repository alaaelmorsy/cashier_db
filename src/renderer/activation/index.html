<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; script-src 'self' 'unsafe-inline'">
  <title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ - POS SA</title>
  <link rel="stylesheet" href="../tailwind-output.css">
  <style>
    /* Local Cairo font faces */
    @font-face {
      font-family: 'Cairo';
      src: url('../../../assets/fonts/Cairo-Regular.ttf') format('truetype');
      font-weight: 400; font-style: normal; font-display: swap;
    }
    @font-face {
      font-family: 'Cairo';
      src: url('../../../assets/fonts/Cairo-Bold.ttf') format('truetype');
      font-weight: 700; font-style: normal; font-display: swap;
    }
    @font-face {
      font-family: 'Cairo';
      src: url('../../../assets/fonts/Cairo-Black.ttf') format('truetype');
      font-weight: 900; font-style: normal; font-display: swap;
    }

    body {
      font-family: "Cairo", "Tajawal", system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    /* ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†Ø² Ù„Ù„Ø³Ø±Ø¹Ø© (Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª) */
    *, *::before, *::after {
      animation: none !important;
      transition: none !important;
    }
    
    /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Toast Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
    }
    
    .toast {
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      font-size: 15px;
      transform: translateX(120%);
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.3s ease !important;
      opacity: 0;
    }
    
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .toast.hide {
      transform: translateX(120%);
      opacity: 0;
    }
    
    .toast-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: 2px solid #047857;
    }
    
    .toast-error {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      border: 2px solid #b91c1c;
    }
    
    .toast-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø© */
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .card-glass {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
    }
    
    .logo-gradient {
      background: linear-gradient(135deg, #0057FF, #4C85FF);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #0057FF, #4C85FF);
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #003DC7, #0057FF);
    }
    
    .input-focus:focus {
      border-color: #0057FF;
      box-shadow: 0 0 0 3px rgba(0, 87, 255, 0.1);
    }

    /* ØªØ­Ø³ÙŠÙ† Modal */
    .modal-overlay {
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">

  <!-- Toast Notifications Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Ø§ØªØµØ§Ù„ IP Modal -->
  <div id="connModal" class="fixed inset-0 hidden items-center justify-center modal-overlay z-50">
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl border-2 border-blue-100">
      <div class="flex items-center justify-between p-5 border-b-2 border-blue-50 bg-gradient-to-r from-blue-50 to-blue-25">
        <div class="font-black text-lg text-blue-600">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
        <button id="connClose" class="px-4 py-2 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="p-6 max-h-[70vh] overflow-y-auto">
        <!-- IP Address -->
        <div class="mb-4">
          <label class="block mb-2 font-bold text-sm text-gray-700">ğŸŒ Ø¹Ù†ÙˆØ§Ù† IP Ù„Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
          <input id="serverIp" placeholder="Ù…Ø«Ø§Ù„: 192.168.1.100" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-base input-focus outline-none" />
          <div class="mt-2 text-xs text-gray-500">Ø§ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
        </div>
        
        <!-- Warning Box -->
        <div class="mb-5 p-4 bg-gradient-to-r from-orange-50 to-orange-25 border-2 border-orange-200 rounded-xl">
          <p class="font-bold text-gray-800 mb-2 text-sm">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:</p>
          <ul class="m-0 pr-5 text-gray-700 leading-relaxed text-xs">
            <li>Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ IP Ù„Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØŒ Ø³ÙŠØµØ¨Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² <strong>ÙØ±Ø¹ÙŠØ§Ù‹</strong> ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
            <li>Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ÙØ±Ø¹ÙŠ <strong>Ù„Ø§ ÙŠØ­ØªØ§Ø¬</strong> Ø¥Ù„Ù‰ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„</li>
            <li>ÙŠØ¬Ø¨ <strong>Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</strong> Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</li>
          </ul>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex gap-3">
          <button id="testIpBtn" class="flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold hover:from-green-600 hover:to-green-700">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
          <button id="saveIpBtn" class="flex-1 px-4 py-3 btn-primary text-white rounded-xl font-bold">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>
        <div id="ipMsg" class="hidden mt-3 px-4 py-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-center font-semibold"></div>
      </div>
    </div>
  </div>

  <!-- Main Card -->
  <div class="w-full max-w-md">
    <div class="card-glass rounded-3xl shadow-2xl p-8 border-2 border-white/30">
      
      <!-- Brand -->
      <div class="flex items-center justify-center gap-5 mb-4">
        <div class="w-20 h-20 logo-gradient rounded-2xl flex items-center justify-center text-white font-black text-2xl shadow-xl">
          POS
        </div>
        <h1 class="text-4xl font-black text-gray-800">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h1>
      </div>

      <!-- Company Badge -->
      <div class="text-center mb-6">
        <div class="inline-block px-6 py-3 bg-gradient-to-r from-red-100 to-pink-100 border-2 border-red-200 rounded-full">
          <span class="text-red-600 font-black text-base">ğŸ¢ Ù…Ø¤Ø³Ø³Ø© ØªØ¹Ù„Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª</span>
        </div>
      </div>

      <!-- Quit Button -->
      <div class="flex justify-center mb-6">
        <button id="quitBtn" class="px-8 py-3 bg-white border-2 border-gray-200 rounded-xl font-bold text-gray-700 hover:bg-gray-50 hover:border-gray-300">
          Ø®Ø±ÙˆØ¬
        </button>
      </div>

      <!-- Activation Section -->
      <div id="activationSection" style="display:none;">
        <div class="mb-6">
          <label for="code" class="block mb-3 font-bold text-sm text-gray-700 uppercase tracking-wide">
            ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ (Ù„Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø·)
          </label>
          <div class="relative">
            <input 
              id="code" 
              type="password" 
              placeholder="â€¢ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø³Ù„ Ù…Ù† Ø§Ù„Ø¯Ø¹Ù…" 
              autocomplete="off"
              class="w-full px-5 pr-12 py-4 border-2 border-gray-200 rounded-2xl text-base input-focus outline-none bg-white shadow-sm"
            />
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-xl opacity-70">ğŸ”</div>
          </div>
        </div>

        <button id="activateBtn" class="w-full px-6 py-4 btn-primary text-white rounded-2xl font-bold text-lg shadow-lg">
          ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†
        </button>

        <div class="mt-6 p-5 bg-gray-50 border border-gray-100 rounded-2xl text-center">
          <p class="text-gray-600 text-sm font-medium leading-relaxed">
            Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ.
          </p>
        </div>
      </div>

      <!-- Connection Settings Button -->
      <div class="mt-6 flex justify-center">
        <button id="openConnDialog" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-bold hover:from-blue-600 hover:to-blue-700 shadow-md">
          âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        </button>
      </div>

      <!-- Warning -->
      <div class="mt-6 p-5 bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-200 rounded-2xl">
        <p class="text-red-600 text-xs font-semibold leading-relaxed text-center">
          âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…ÙØ±Ø®Øµ Ø­ØµØ±ÙŠØ§Ù‹ Ù„Ù…Ø¤Ø³Ø³Ø© ØªØ¹Ù„Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª. Ø£ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ ÙŠÙØ¹ØªØ¨Ø± Ø§Ù†ØªÙ‡Ø§ÙƒØ§Ù‹ Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ©.
        </p>
      </div>

    </div>
  </div>

  <script>
    (async function(){
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙÙØ¹Ù„Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (fallback safety check)
      try{
        const r = await window.api.license_check();
        if(r && r.ok){ location.replace('../login/index.html'); return; }
      }catch(_){ /* ØªØ¬Ø§Ù‡Ù„ */ }

      // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„ Ø¨Ø¬Ù‡Ø§Ø² Ø¨Ø¹ÙŠØ¯ (ØºÙŠØ± localhost)
      try{
        const cfg = await window.api.db_get_config();
        if(cfg && cfg.ok && cfg.config){
          const h = String(cfg.config.host||'').toLowerCase();
          const isRemote = h && h !== '127.0.0.1' && h !== 'localhost';
          if(isRemote){
            // Ø¬Ù‡Ø§Ø² ÙØ±Ø¹ÙŠ Ù…ØªØµÙ„ Ø¨Ø¬Ù‡Ø§Ø² Ø±Ø¦ÙŠØ³ÙŠ - Ø§Ø°Ù‡Ø¨ Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            location.replace('../login/index.html');
            return;
          } else {
            // Ø¬Ù‡Ø§Ø² Ø±Ø¦ÙŠØ³ÙŠ (localhost) - Ø§Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªÙØ¹ÙŠÙ„
            document.getElementById('activationSection').style.display = '';
          }
        }
      }catch(_){ }

      const toastContainer = document.getElementById('toastContainer');
      
      function showToast(message, type = 'error', duration = 5000) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Toast
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        const icon = type === 'success' ? 'âœ“' : 'âœ•';
        toast.innerHTML = `
          <span class="toast-icon">${icon}</span>
          <span style="flex: 1;">${message}</span>
        `;
        
        toastContainer.appendChild(toast);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Toast Ø¨Ø¹Ø¯ delay ØµØºÙŠØ± Ù„Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        setTimeout(() => {
          toast.classList.add('show');
        }, 10);
        
        // Ø¥Ø®ÙØ§Ø¡ ÙˆØ¥Ø²Ø§Ù„Ø© Toast Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        if(duration > 0) {
          setTimeout(() => {
            toast.classList.remove('show');
            toast.classList.add('hide');
            setTimeout(() => {
              if(toast.parentNode) {
                toastContainer.removeChild(toast);
              }
            }, 400);
          }, duration);
        }
        
        return toast;
      }
      
      function showError(message, duration = 5000) {
        if(message) showToast(message, 'error', duration);
      }
      
      function showSuccess(message, duration = 4000) {
        if(message) showToast(message, 'success', duration);
      }

      function normalize(code){
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø´Ø±Ø·Ø§Øª ÙˆØªØ­ÙˆÙŠÙ„ Ù„Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø©
        return String(code||'').replace(/\s|-/g,'').toUpperCase();
      }

      document.getElementById('activateBtn').addEventListener('click', async () => {
        const raw = document.getElementById('code').value;
        const code = normalize(raw);
        if(!code){ 
          showError('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„');
          return;
        }
        
        const res = await window.api.license_activate(code);
        if(!res || !res.ok){ 
          showError('âŒ ' + (res && res.error ? res.error : 'ÙØ´Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„'));
          return;
        }
        
        // Ù†Ø¬Ø§Ø­ â€” Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØªÙŠÙ† Ø«Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
        showSuccess('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¯Ø®ÙˆÙ„...', 2500);
        setTimeout(() => {
          location.replace('../login/index.html');
        }, 2000);
      });

      document.getElementById('quitBtn').addEventListener('click', () => {
        try{ window.api.app_quit(); }catch(_){ }
      });

      // Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±
      document.getElementById('code').addEventListener('keydown', (e)=>{ if(e.key==='Enter') document.getElementById('activateBtn').click(); });

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // Connection Settings Modal Logic
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const connModal = document.getElementById('connModal');
      const openConnBtn = document.getElementById('openConnDialog');
      const connCloseBtn = document.getElementById('connClose');
      const testIpBtn = document.getElementById('testIpBtn');
      const saveIpBtn = document.getElementById('saveIpBtn');
      const ipMsg = document.getElementById('ipMsg');

      openConnBtn.addEventListener('click', () => {
        connModal.classList.remove('hidden');
        connModal.classList.add('flex');
      });

      connCloseBtn.addEventListener('click', () => {
        connModal.classList.remove('flex');
        connModal.classList.add('hidden');
      });

      testIpBtn.addEventListener('click', async () => {
        const ip = document.getElementById('serverIp').value.trim();
        const port = 3306;

        if(!ip){
          ipMsg.className = 'mt-3 px-4 py-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-center font-semibold';
          ipMsg.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ IP Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
          ipMsg.classList.remove('hidden');
          return;
        }

        testIpBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
        testIpBtn.disabled = true;

        try {
          const result = await window.api.db_test({ host: ip, port: port });
          if(result && result.ok){
            ipMsg.className = 'mt-3 px-4 py-3 bg-green-50 border-2 border-green-200 rounded-xl text-green-600 text-center font-semibold';
            ipMsg.textContent = 'âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
            ipMsg.classList.remove('hidden');
            showSuccess('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ');
          } else {
            ipMsg.className = 'mt-3 px-4 py-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-center font-semibold';
            ipMsg.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + (result.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');
            ipMsg.classList.remove('hidden');
            showError('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + (result.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
          }
        } catch(err) {
          ipMsg.className = 'mt-3 px-4 py-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-center font-semibold';
          ipMsg.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + String(err);
          ipMsg.classList.remove('hidden');
          showError('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
        } finally {
          testIpBtn.textContent = 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„';
          testIpBtn.disabled = false;
        }
      });

      saveIpBtn.addEventListener('click', async () => {
        const ip = document.getElementById('serverIp').value.trim();
        const port = 3306;

        if(!ip){
          ipMsg.className = 'mt-3 px-4 py-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-center font-semibold';
          ipMsg.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ IP Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
          ipMsg.classList.remove('hidden');
          return;
        }

        saveIpBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        saveIpBtn.disabled = true;

        try {
          // Apply DB config
          const applyResult = await window.api.db_apply({ host: ip, port: port });
          if(!applyResult || !applyResult.ok){
            throw new Error(applyResult.error || 'ÙØ´Ù„ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          }

          // Set device mode to secondary
          const modeResult = await window.api.device_set_mode({
            mode: 'secondary',
            api_host: ip,
            api_port: 4310
          });
          if(!modeResult || !modeResult.ok){
            throw new Error(modeResult.error || 'ÙØ´Ù„ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²');
          }

          // Success
          ipMsg.className = 'mt-3 px-4 py-3 bg-green-50 border-2 border-green-200 rounded-xl text-green-600 text-center font-semibold';
          ipMsg.textContent = 'âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„...';
          ipMsg.classList.remove('hidden');
          showSuccess('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„...', 2500);

          setTimeout(() => {
            location.replace('../login/index.html');
          }, 2000);

        } catch(err) {
          ipMsg.className = 'mt-3 px-4 py-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-center font-semibold';
          ipMsg.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + String(err.message || err);
          ipMsg.classList.remove('hidden');
          showError('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + String(err.message || err));
        } finally {
          saveIpBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
          saveIpBtn.disabled = false;
        }
      });

    })();
  </script>
  <script src="../theme.js"></script>
</body>
</html>
