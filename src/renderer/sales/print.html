<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</title>
    <style>
      @font-face{
        font-family: 'Cairo';
        src: url('../../../assets/fonts/Cairo-Black.ttf') format('truetype');
        font-weight: 900;
        font-display: swap;
      }
      @font-face{
        font-family: 'saudi_riyal';
        src: url('../../../assets/fonts/saudi-riyal.woff') format('woff'),
             url('../../../assets/fonts/saudi-riyal.ttf') format('truetype');
        font-display: swap;
        unicode-range: U+E900; /* Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø®Ø§Øµ 'î¤€' */
      }
      :root{ --m-left: 0mm; --m-right: 0mm; }
      @media print {
        /* Ù‡ÙˆØ§Ù…Ø´ Ù…ØªØ­Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹ Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¢Ù…Ù†Ø© */
        @page { size: 80mm auto; margin: 0mm 3mm 6mm 3mm; }
        html, body { width: auto; height: auto; overflow: visible; }
        /* ØªÙ…Ø±ÙƒØ² Ø£ÙÙ‚ÙŠ Ø¯Ù‚ÙŠÙ‚ Ø­ØªÙ‰ Ù…Ø¹ Ø§Ø®ØªÙ„Ø§Ù Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ù…Ø´ØºÙ„ */
        body{ display:flex; justify-content:center; padding-left: var(--m-left); padding-right: var(--m-right); }
        /* Ø§Ù…Ù†Ø¹ ØªÙ‚Ø·ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„/Ø§Ù„Ø£Ø³Ø·Ø± */
        table, tr, td, th, .ticket { page-break-inside: avoid; break-inside: avoid; }
      }

      /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© */
      @media print {
        .section-badge,
        .ticket > .section-title + .muted,
        .ticket > .section-title + .muted + .muted,
        .ticket > .section-title + .muted + .muted + .muted,
        table thead th {
          background: transparent !important;
        }
      }

      body{ font-family: 'Cairo', 'saudi_riyal', system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", Arial, sans-serif; margin:0; color:#000; font-weight:900; font-size:11px; letter-spacing:.08px; }
      /* Ø­Ø§ÙˆÙŠØ© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ…Ø±ÙƒØ² Ø§Ù„ØªØ§Ù… Ø¯Ø§Ø®Ù„ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
      .page{ width: 80mm; margin: 0 auto; display: block; }
      /* Ø¹Ø±Ø¶ Ø£ØµØºØ± Ù„Ù„ØªØ°ÙƒØ±Ø© + Ø­Ø§ÙØ§Øª Ø¯Ø§Ø®Ù„ÙŠØ© Ø£ÙƒØ¨Ø± Ù„Ù…Ù†Ø¹ Ù‚Øµ Ø§Ù„Ø­Ø±ÙˆÙ Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† Ø§Ù„ÙˆØ±Ù‚Ø© */
      .ticket{ width: 69mm; margin: 0 auto; padding: 1mm; box-sizing: border-box; border: 2px solid #0f172a; border-radius: 8px; }
      /* Ø§Ù…Ù†Ø¹ Ø£ÙŠ ØªØµØºÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ */
      html{ -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .center{ text-align:center; }
      .muted{ color:#000; font-size:12px; font-weight:900; }
      .desc-print{ color:#000; font-size:10px; font-weight:900; margin-top:2px; white-space:pre-wrap; overflow-wrap:anywhere; word-break:break-word; }
      /* Ù…Ø±Ø¨Ø¹ Ø«Ù‚ÙŠÙ„ ÙŠØ­ÙŠØ· Ø¨ÙƒÙ„ Ø¨Ù†Ø¯ ÙˆÙˆØµÙÙ‡ Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø¹ Ø¬Ù‡Ø§Øª */
      .item-row td, .item-desc-row td{ border-bottom:0 !important; }
      .item-row td{ border-top:2.5px solid #0f172a; padding-top: 0.5mm; padding-bottom: 0.5mm; }
      .item-desc-row td{ border-bottom:2.5px solid #0f172a; padding-bottom: 0.5mm; }
      .item-row td:first-child, .item-desc-row td:first-child{ border-right:2.5px solid #0f172a; }
      .item-row td:last-child, .item-desc-row td:last-child{ border-left:2.5px solid #0f172a; }

      .logo{ width:48px; height:48px; object-fit:contain; border-radius:8px; display:block; margin:0 auto 4px; border:1px solid #cbd5e1; background:#fff; }
      h2{ margin:4px 0; font-size:16px; font-weight:800; }
      .section-title{ display:none !important; }
      .section-badge{ display:inline-block; margin:1px 0 2px; padding:4px 6px; background:#e5e7eb; border:1px solid #cbd5e1; border-radius:6px; font-weight:800; color:#0f172a; font-size:12px; }
      #invType{ font-size:18px; font-weight:800; }

      /* Ø¥Ø·Ø§Ø± Ø®Ø§Ø±Ø¬ÙŠ Ø«Ù‚ÙŠÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯) */
      .ticket > table:first-of-type{
        border: 2px solid #0f172a;
        border-radius: 8px;
        overflow: hidden;
        margin: 0 auto; /* ØªÙ…Ø±ÙƒØ² Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø© */
      }

      /* ØµÙ†Ø¯ÙˆÙ‚ Ø«Ù‚ÙŠÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©/Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø±/Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ */
      .ticket > .section-title + .muted,
      .ticket > .section-title + .muted + .muted,
      .ticket > .section-title + .muted + .muted + .muted{
        margin: 0 !important;
        padding: 1px 6px;
        border-left: 2px solid #0f172a;
        border-right: 2px solid #0f172a;
        background: #f8fafc;
      }
      .ticket > .section-title + .muted{
        border-top: 2px solid #0f172a;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        margin-top: 0px !important;
      }
      .ticket > .section-title + .muted + .muted{
        border-top: 2px solid #0f172a; /* ÙØ§ØµÙ„ Ø¯Ø§Ø®Ù„ÙŠ Ø«Ù‚ÙŠÙ„ */
      }
      .ticket > .section-title + .muted + .muted + .muted{
        border-top: 2px solid #0f172a; /* ÙØ§ØµÙ„ Ø¯Ø§Ø®Ù„ÙŠ Ø«Ù‚ÙŠÙ„ */
        border-bottom: 2px solid #0f172a;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        margin-bottom: 0px !important;
      }
      /* Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø³Ø·Ø± "Ù…Ø¯Ø®Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©"ØŒ Ù…Ø¯Ù‘Ø¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø«Ù‚ÙŠÙ„ Ù„ÙŠØ´Ù…Ù„Ù‡ ÙƒØ³Ø·Ø± Ø£Ø®ÙŠØ± */
      .ticket:has(> #userLine:not([hidden])) > .section-title + .muted + .muted + .muted{
        border-bottom: 0 !important;
        border-bottom-left-radius: 0 !important;
        border-bottom-right-radius: 0 !important;
        margin-bottom: 0 !important;
      }
      /* Ø·Ø¨Ù‘Ù‚ Ù†ÙØ³ ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø«Ù‚ÙŠÙ„ Ø¹Ù„Ù‰ Ø³Ø·Ø± "Ù…Ø¯Ø®Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø¸Ø§Ù‡Ø±Ù‹Ø§ */
      #userLine:not([hidden]){
        margin: 0 !important;
        padding: 1px 6px;
        border-left: 2px solid #0f172a;
        border-right: 2px solid #0f172a;
        border-top: 2px solid #0f172a; /* ÙØ§ØµÙ„ Ø¯Ø§Ø®Ù„ÙŠ Ø«Ù‚ÙŠÙ„ */
        border-bottom: 2px solid #0f172a;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        background: #f8fafc;
      }
      table{ width:100%; border-collapse:collapse; table-layout:fixed; }
      th, td{ font-size:11px; padding:0px 3px; border-bottom:1px solid #cbd5e1; font-weight:900; line-height:1.1; }
      th{ text-align:right; background:#eef2ff; color:#0b3daa; font-size:10px; padding-top: 0.5mm; padding-bottom: 0.5mm; }
      /* Ø¶Ø¨Ø· Ø£Ø¹Ù…Ø¯Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù…Ø¹ Ø¯Ø¹Ù… Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ */
      /* Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© */
      .has-op thead th:nth-child(1), .has-op tbody td:nth-child(1){ width:28%; white-space:normal; word-break:anywhere; overflow-wrap:anywhere; }
      .has-op thead th:nth-child(2), .has-op tbody td:nth-child(2){ width:18%; word-break:keep-all; }
      .has-op thead th:nth-child(3), .has-op tbody td:nth-child(3){ width:16%; text-align:center; }
      .has-op thead th:nth-child(4), .has-op tbody td:nth-child(4){ width:12%; text-align:center; }
      .has-op thead th:nth-child(5), .has-op tbody td:nth-child(5){ width:26%; text-align:left; word-break:anywhere; }
      /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ© */
      .has-op thead th:nth-child(1), .has-op tbody td:nth-child(1){ padding-left:1px; padding-right:0px; }
      .has-op thead th:nth-child(2), .has-op tbody td:nth-child(2){ padding-left:1px; padding-right:1px; font-size:8px; }
      /* Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Øµ ÙÙŠ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŒ Ù‚Ù„Ù„ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø£ÙƒØ«Ø± Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
      .has-op tbody td:nth-child(2):not(:empty){ font-size:7.5px; line-height:1; padding-top:1px; padding-bottom:1px; }
      /* ØªÙ‚Ù„ÙŠÙ„ padding Ù„Ù„Ø£Ø±Ù‚Ø§Ù… */
      .has-op tbody td:nth-child(3),
      .has-op tbody td:nth-child(4),
      .has-op tbody td:nth-child(5){ padding-left:1px; padding-right:1px; }

      /* Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù…ÙˆØ¯ ØªÙ…Ø§Ù…Ù‹Ø§) */
      .no-op thead th:nth-child(1), .no-op tbody td:nth-child(1){ width:48%; white-space:normal; word-break:anywhere; overflow-wrap:anywhere; }
      .no-op thead th:nth-child(2), .no-op tbody td:nth-child(2){ display:none; }
      .no-op thead th:nth-child(3), .no-op tbody td:nth-child(3){ width:17%; text-align:center; }
      .no-op thead th:nth-child(4), .no-op tbody td:nth-child(4){ width:15%; text-align:center; }
      .no-op thead th:nth-child(5), .no-op tbody td:nth-child(5){ width:20%; text-align:left; word-break:anywhere; }

      /* Ø§Ø¬Ø¹Ù„ "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ù…Ø¹ ØªØµØºÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ø®Ø· */
      thead th:nth-child(5){
        white-space: nowrap !important;
        overflow-wrap: normal !important;
        word-break: keep-all !important;
        font-size: 11px !important;
      }



      /* Ø§Ø¬Ø¹Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙŠØ­Ø³Ø¨ Ø§Ù„Ø­ÙˆØ§Ø´ÙŠ ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù‚Øµ */
      th, td{ box-sizing:border-box; }

      /* Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…: Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…Ø¹ ØªØµØºÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø¨Ø± JS */
      tbody td.num{ 
        white-space: nowrap !important;           /* Ù„Ø§ Ù„Ù */
        overflow: visible !important;             /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¸Ù‡ÙˆØ± Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        direction: ltr;                /* Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙŠØ³Ø§Ø±â†’ÙŠÙ…ÙŠÙ† */
        unicode-bidi: plaintext;       /* Ø¹Ø²Ù„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ */
        font-variant-numeric: tabular-nums; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø£Ø±Ù‚Ø§Ù… Ø«Ø§Ø¨ØªØ© Ø§Ù„Ø¹Ø±Ø¶ */
        font-weight: 700 !important;   /* Ø£Ø±Ù‚Ø§Ù… Ø«Ù‚ÙŠÙ„Ø© ÙˆÙˆØ§Ø¶Ø­Ø© */
        font-size: 11px;              /* Ø­Ø¬Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ Ø³ÙŠØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ Ù„Ø²Ù… */
        line-height: 1.1;                /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ù†Ø§Ø³Ø¨ */
        letter-spacing: 0;
        text-align: inherit;           /* Ø§Ø­ÙØ¸ Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ */
        padding-left: 1px;           /* Ù…Ø³Ø§Ø­Ø© Ø£ÙÙ‚ÙŠØ© Ø¶Ø¦ÙŠÙ„Ø© */
        padding-right: 1px;
        position: relative;
      }
      /* Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ num-inner */
      tbody td.num .num-inner{
        display: inline-block;
        white-space: nowrap !important;
        text-overflow: clip !important;
      }
      .totals td{ font-size:13px; font-weight:700; }
      .bold{ font-weight:800; }
      .footer{ margin-top:6px; text-align:center; font-size:10.5px; color:#000; font-weight:900; }
      #companyInfo{ white-space:pre-wrap; font-weight:800; }
      /* ØªØ®Ø·ÙŠØ· Ù…Ø­Ø³Ù‘Ù† Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© */
      #companySection{
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        padding: 6px 6px 4px;
        margin-bottom: 1px;
        background: #f8fafc;
      }
      #header{ border-bottom: 1px dashed #cbd5e1; padding-bottom: 4px !important; margin-bottom: 4px; }
      #company{ letter-spacing: .2px; }
      #companyInfo{ text-align: center; line-height: 1.2; }

      /* ØªØ®Ø·ÙŠØ· Ù…Ø­Ø³Ù‘Ù† Ù„Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª */
      table.totals{
        margin-top: 0px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        overflow: hidden;
        background: #f8fafc;
      }
      table.totals tbody tr td{
        padding-top: 1mm;
        padding-bottom: 1mm;
      }
      table.totals tbody tr td:first-child{
        width: 60%;
        border-left: 1px solid #e2e8f0;
      }
      table.totals tbody tr td:last-child{
        width: 40%;
        text-align: left;
        font-weight: 800;
      }
      table.totals tbody tr{
        border-bottom: 1px dashed #e2e8f0;
      }
      table.totals tbody tr:last-child{
        border-bottom: 0;
      }
      /* Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© */
      table.totals tbody tr:nth-child(2) td, /* Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© */
      table.totals tbody tr:nth-child(4) td, /* Ø¶Ø±ÙŠØ¨Ø© VAT (Ø¨Ø¹Ø¯ ÙˆØ¬ÙˆØ¯ ØµÙÙˆÙ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©) */
      table.totals tbody tr.bold td {        /* Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© */
        background: #eef2ff;
      }
      /* Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ØµÙÙˆÙ Ø¥Ø¶Ø§ÙÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… */
      #vat{ font-weight: 800; }
      #grand{ font-weight: 900; }

      /* Ø¥Ø·Ø§Ø± Ø«Ù‚ÙŠÙ„ ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø«Ù„Ø§Ø« Ø®Ø§Ù†Ø§Øª (Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) Ù…Ø¹ ÙÙˆØ§ØµÙ„ Ø³Ù…ÙŠÙƒØ© Ø¨ÙŠÙ† ÙƒÙ„ Ø®Ø§Ù†Ø© */
      table.totals{ border-collapse: collapse; }
      /* Ø£Ø²Ù„ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…ØªÙ‚Ø·Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø«Ù„Ø§Ø«Ø© */
      table.totals tbody tr:has(td#sub),
      table.totals tbody tr:has(td#vat),
      table.totals tbody tr:has(td#grand){
        border-bottom: 0 !important;
      }
      /* Ø­Ø¯ÙˆØ¯ Ø¬Ø§Ù†Ø¨ÙŠØ© Ø³Ù…ÙŠÙƒØ© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© */
      table.totals tbody tr:has(td#sub) td,
      table.totals tbody tr:has(td#vat) td,
      table.totals tbody tr:has(td#grand) td{
        border-left: 2.5px solid #0f172a !important;
        border-right: 2.5px solid #0f172a !important;
      }
      /* ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ù†ÙØ³ Ø§Ù„ØªØ®Ø·ÙŠØ· */
      table.totals tbody tr#extraRow td,
      table.totals tbody tr#discRow td,
      table.totals tbody tr#afterDiscRow td,
      table.totals tbody tr#tobaccoFeeRow td,
      table.totals tbody tr#couponRow td,
      table.totals tbody tr#paidRow td,
      table.totals tbody tr#remainRow td,
      table.totals tbody tr#changeRow td{
        border-left: 2.5px solid #0f172a !important;
        border-right: 2.5px solid #0f172a !important;
      }
      /* Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…Ù‡Ù…Ø§ ØªØºÙŠÙ‘Ø± ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ */
      table.totals tbody tr:has(td#sub) td,
      table.totals tbody tr:has(td#vat) td,
      table.totals tbody tr:has(td#grand) td{
        background: #eef2ff;
      }
      /* Ø­Ø¯ Ø¹Ù„ÙˆÙŠ Ø³Ù…ÙŠÙƒ Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© */
      table.totals tbody tr:has(td#sub) td{ border-top: 2.5px solid #0f172a !important; }
      /* Ø®Ø· Ø¹Ù„ÙˆÙŠ Ø¨Ù†ÙØ³ Ø§Ù„Ø³Ù…Ø§ÙƒØ© ÙÙˆÙ‚ ØµÙ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± ÙØ§ØµÙ„ ÙˆØ§Ø¶Ø­ */
      table.totals tbody tr:has(td#sub) td:first-child{ border-top: 2px solid #0f172a !important; }
      /* ÙØ§ØµÙ„ Ø³Ù…ÙŠÙƒ Ø¨ÙŠÙ† (Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) Ùˆ(Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) */
      table.totals tbody tr:has(td#vat) td{ border-top: 2.5px solid #0f172a !important; }
      /* ÙØ§ØµÙ„ Ø³Ù…ÙŠÙƒ Ø¨ÙŠÙ† (Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) Ùˆ(Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) + Ø­Ø¯ Ø³ÙÙ„ÙŠ Ø³Ù…ÙŠÙƒ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø£Ùˆ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù…Ø¯ÙÙˆØ¹/Ù…ØªØ¨Ù‚ÙŠ) */
      table.totals tbody tr#changeRow td,
      table.totals tbody tr#remainRow td,
      table.totals tbody tr#paidRow td,
      table.totals tbody tr#couponRow td,
      table.totals tbody tr#discRow td,
      table.totals tbody tr#afterDiscRow td,
      table.totals tbody tr:has(td#grand) td{
        border-top: 2.5px solid #0f172a !important;
      }
      table.totals tbody tr#changeRow:last-child td,
      table.totals tbody tr#remainRow:last-child td,
      table.totals tbody tr#paidRow:last-child td,
      table.totals tbody tr#couponRow:last-child td,
      table.totals tbody tr:has(td#grand):last-child td{
        border-bottom: 2.5px solid #0f172a !important;
      }
      /* Ø®Ø· Ø³Ù…ÙŠÙƒ Ø«Ø§Ø¨Øª Ø£Ø³ÙÙ„ ØµÙ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) */
      table.totals tbody tr:has(td#grand) td{
        border-bottom: 2.5px solid #0f172a !important;
      }
      /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±: Ù„Ø§ ØªØ¶Ù Ø­Ø¯Ù‹Ø§ Ø¹Ù„ÙˆÙŠÙ‹Ø§ Ù„Ù„ØµÙ Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) */
      table.totals tbody tr:has(td#grand) + tr td{
        border-top: 0 !important;
      }
      .currency-symbol{ font-family:'Cairo', 'saudi_riyal', system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", Arial, sans-serif; font-size:1em; line-height:0; vertical-align:-0.05em; margin:0 2px; }
.desc-title{ font-weight:800; color:#0b3daa; margin-inline-start:4px; }
tr.item-desc-row td{ border-bottom:2px solid #64748b; padding-bottom: 0.5mm; }
    .reprint-btn{ position:fixed; top:8px; left:8px; padding:8px 10px; border:0; border-radius:8px; background:#0b3daa; color:#fff; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.15);} 
    .export-btn{ position:fixed; top:48px; left:8px; padding:8px 10px; border:0; border-radius:8px; background:#16a34a; color:#fff; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.15);} 
    .whats-btn{ position:fixed; top:88px; left:8px; padding:8px 10px; border:0; border-radius:8px; background:#25D366; color:#fff; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.15);} 
    @media print { .reprint-btn, .export-btn, .whats-btn{ display:none } #lowStockBanner{ display:none !important; } }

    /* Ø²ÙŠØ§Ø¯Ø© ÙˆØ¶ÙˆØ­ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: Ø¬Ø¹Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø®Ø· Ø£Ø«Ù‚Ù„ */
    /* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ù…Ø¨Ø§Ø´Ø±Ø© (Ø§Ù„Ø³Ø·Ø±ÙŠÙ† Ø§Ù„ØªØ§Ù„ÙŠÙŠÙ†) â€” Ù…Ø«Ù„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© */
    .section-title + .muted,
    .section-title + .muted + .muted,
    #paidAtLine,
    #roomLine { font-weight: 700; font-size: 12px; color: #0f172a; }

    /* ØªØ±ÙˆÙŠØ³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø®Ø· Ø£Ø«Ù‚Ù„ØŒ ÙˆÙ‚ÙŠÙ… Ø§Ù„ØµÙÙˆÙ Ø£ÙˆØ¶Ø­ */
    table thead th { font-weight: 800; }
    table tbody td { font-weight: 700; }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„: Ø®Ø· Ø£Ø³ÙˆØ¯ Ø«Ù‚ÙŠÙ„ Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª */
    #driverCard, #driverCard *,
    #custCard, #custCard *{ font-weight:800 !important; color:#0f172a !important; font-size:11px !important; line-height:1.05 !important; }
    /* ÙÙˆØ§ØµÙ„ Ø³Ù…ÙŠÙƒØ© Ø¨ÙŠÙ† Ø£Ø³Ø·Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ø®Ù„ÙÙŠØ© Ø®ÙÙŠÙØ© */
    #custCard .cust-row + .cust-row{ border-top: 2.5px solid #0f172a; }
    #custCard .cust-row{ background:#f8fafc; }

    /* ØªÙˆØ­ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø· ÙˆØ§Ù„ÙˆØ²Ù† ÙˆØ§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„Ø­Ø¬Ù… Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ØªÙ… ØªØµØºÙŠØ±Ù‡ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø·ÙˆÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©) */
    *, *::before, *::after{
      font-family: 'Cairo', 'saudi_riyal', system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", Arial, sans-serif !important;
      font-weight: 900 !important;
      color: #000 !important;
      font-size: 12px !important;
    }
    </style>
  </head>
  <body>
    <button class="reprint-btn" id="reprintBtn" onclick="window.print()">Ø¥Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="export-btn" id="exportBtn">ØªØµØ¯ÙŠØ± PDF</button>
    <button class="whats-btn" id="whatsBtn">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</button>
    <div class="ticket">
      <div id="companySection">
        <div id="header" class="center" style="padding:6px 0;">
          <img id="logo" class="logo" alt="" />
          <h2 id="company">Ø§Ù„Ø´Ø±ÙƒØ©</h2>
          <div id="companyInfo" class="muted"></div>
        </div>
      </div>

      <div class="center"><span id="invType" class="section-badge" style="display:none;">ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ© Ù…Ø¨Ø³Ø·Ø©</span></div>
      <div class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
      <div class="muted" style="margin:0; display:flex; justify-content:flex-start; gap:8px;">
        <div>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="invNo"></span></div>
      </div>

      <div class="muted" style="margin:0;">
        <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="invDate"></span></div>
      </div>
      <div class="muted" style="margin:0;">
        <div>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: <span id="invPay"></span></div>
      </div>
      <div class="muted" style="margin:0;" id="userLine" hidden>
        <div>Ù…Ø¯Ø®Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="cashierName"></span></div>
      </div>
      <div style="margin:4px 0; display:none; font-weight:700; color:#16a34a;" id="paidAtLine">ğŸ’³ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹: <span id="paidAt"></span></div>
      <div class="muted" style="margin:4px 0;" id="roomLine" hidden>Ø§Ù„ØºØ±ÙØ©: <span id="roomName"></span></div>

      <div id="driverCard" style="display:none; border:1px dashed #94a3b8; border-radius:8px; padding:6px; margin-bottom:6px;">
        <div style="font-weight:700; color:#0b3daa; margin-bottom:4px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚</div>
        <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
          <div class="muted"><span style="color:#334155">Ø§Ù„Ø§Ø³Ù…:</span> <span id="drvName"></span></div>
          <div class="muted" id="drvPhone" style="display:none"><span style="color:#334155">Ø¬ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚:</span> <span></span></div>
        </div>
      </div>

      <div id="custCard" style="border:2.5px solid #0f172a; border-radius:8px; padding:0; margin-bottom:0px; overflow:hidden;">
        <div style="font-weight:800; padding:4px 6px; background:#e5e7eb; border-bottom:2.5px solid #0f172a;" id="ccName"></div>
        <div style="display:grid; font-size:11px;">
          <div class="cust-row" id="ccPhone" style="display:none; padding:4px 6px;">Ø¬ÙˆØ§Ù„: <span></span></div>
          <div class="cust-row" id="ccEmail" style="display:none; padding:4px 6px;">Ø¥ÙŠÙ…ÙŠÙ„: <span></span></div>
          <div class="cust-row" id="ccAddress" style="display:none; padding:4px 6px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: <span></span></div>
          <div class="cust-row" id="ccVat" style="display:none; padding:4px 6px;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ: <span></span></div>
          <div class="cust-row" id="ccCR" style="display:none; padding:4px 6px;">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ: <span></span></div>
          <div class="cust-row" id="ccNat" style="display:none; padding:4px 6px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ: <span></span></div>
          <div class="cust-row" id="ccNotes" style="display:none; padding:4px 6px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: <span></span></div>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
            <th id="thPrice">Ø³Ø¹Ø±</th>
            <th id="thQty">ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          </tr>
        </thead>
        <tbody id="items"></tbody>
      </table>

      <table class="totals">
        <tbody>
          <tr id="extraRow" style="display:none"><td>Ø§Ù„Ø¥Ø¶Ø§ÙÙ‰</td><td style="text-align:left" id="extra"></td></tr>
          <tr><td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</td><td style="text-align:left" id="sub"></td></tr>
          <tr id="discRow" style="display:none"><td id="discLabel">Ø®ØµÙ…</td><td style="text-align:left; color:#b91c1c" id="disc"></td></tr>
          <tr id="afterDiscRow" style="display:none"><td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… (Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©)</td><td style="text-align:left" id="afterDisc"></td></tr>
          <tr id="tobaccoFeeRow" style="display:none"><td>Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ¨Øº</td><td style="text-align:left" id="tobaccoFee"></td></tr>
          <tr><td>Ø¶Ø±ÙŠØ¨Ø© VAT</td><td style="text-align:left" id="vat"></td></tr>
          <tr class="bold"><td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</td><td style="text-align:left" id="grand"></td></tr>
          <tr id="couponRow" style="display:none"><td id="couponLabel">ÙƒÙˆØ¨ÙˆÙ†</td><td style="text-align:left; color:#0b3daa" id="couponVal"></td></tr>
          <tr id="paidRow" style="display:none"><td>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</td><td style="text-align:left" id="paid"></td></tr>
          <tr id="remainRow" style="display:none"><td>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</td><td style="text-align:left" id="remain"></td></tr>
          <tr id="changeRow" style="display:none"><td>Ø§Ù„Ø¨Ø§Ù‚ÙŠ</td><td style="text-align:left" id="change"></td></tr>
        </tbody>
      </table>

      <div id="qrBox" class="center" style="margin:4px 0;">
        <div id="qr" style="display:inline-block; transform:scale(0.9); transform-origin:center;"></div>
      </div>


    </div>

    <script>
      // Resize preview window to fit the invoice height and width exactly
      function resizeWindowToTicket(){
        try{
          const ticket = document.querySelector('.ticket');
          if(!ticket) return;
          // Ø³Ø±Ø¹Ø© ÙÙˆØ±ÙŠØ©: Ø¨Ø¯ÙˆÙ† requestAnimationFrame Ù„Ù„ØªØ³Ø±ÙŠØ¹
          const rect = ticket.getBoundingClientRect();
          const frameW = window.outerWidth - window.innerWidth;
          const frameH = window.outerHeight - window.innerHeight;
          const targetW = Math.max(360, Math.ceil(rect.width) + (isFinite(frameW)?frameW:0));
          // Ø£Ø¶Ù Ù…Ø³Ø§Ø­Ø© ØµØºÙŠØ±Ø© Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ù„ØªØ¬Ù†Ø¨ Ù‚Ø·Ø¹ Ø¢Ø®Ø± Ø³Ø·Ø±
          const targetH = Math.max(320, Math.ceil(rect.height) + 16 + (isFinite(frameH)?frameH:0));
          const maxW = (window.screen && window.screen.availWidth) ? window.screen.availWidth : targetW;
          const maxH = (window.screen && window.screen.availHeight) ? window.screen.availHeight : targetH;
          window.resizeTo(Math.min(targetW, maxW), Math.min(targetH, maxH));
        }catch(_){ /* ignore */ }
      }

      (async function(){
        // Ø¯Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„ØªÙ‚Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø­Ø¸Ø± Ù…Ù† ÙˆØ§ØªØ³Ø§Ø¨ (1-8 Ø«ÙˆØ§Ù†ÙŠ)
        function randomDelay(minMs, maxMs) {
          const delay = Math.floor(Math.random() * (maxMs - minMs + 1)) + minMs;
          return new Promise(resolve => setTimeout(resolve, delay));
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù‚ÙŠØ§Ø³ Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø¨Ø¯Ù‚Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Canvas
        function measureTextWidth(text, fontSize, fontFamily, fontWeight){
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          ctx.font = `${fontWeight} ${fontSize}px ${fontFamily}`;
          return ctx.measureText(text).width;
        }

        // ØªØµØºÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø®Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¯Ø§Ø®Ù„ Ø®Ù„Ø§ÙŠØ§ .num Ø­ØªÙ‰ ØªØ¨Ù‚Ù‰ ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯
        function autoshrinkNumericCells(root){
          try{
            const cells = (root||document).querySelectorAll('tbody td.num');
            let processedCount = 0;
            
            cells.forEach((td, idx) => {
              const inner = td.querySelector('.num-inner');
              if(!inner) return;
              
              const originalText = inner.textContent.trim();
              if(!originalText) return;
              
              // Ø§Ø³Ù…Ø­ Ø¨Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Øµ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„ØµØ­ÙŠØ­
              td.style.overflow = 'visible';
              
              // Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ®Ø·ÙŠØ·
              void td.offsetWidth;
              
              // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠ
              const tdRect = td.getBoundingClientRect();
              const tdStyle = getComputedStyle(td);
              const paddingLeft = parseFloat(tdStyle.paddingLeft) || 0;
              const paddingRight = parseFloat(tdStyle.paddingRight) || 0;
              const borderLeft = parseFloat(tdStyle.borderLeftWidth) || 0;
              const borderRight = parseFloat(tdStyle.borderRightWidth) || 0;
              const maxWidth = tdRect.width - paddingLeft - paddingRight - borderLeft - borderRight - 4;
              
              if(!maxWidth || maxWidth <= 5){
                false && console.warn(`âš ï¸ maxWidth too small: ${maxWidth}px for cell ${idx}`);
                return;
              }
              
              // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø·
              const innerStyle = getComputedStyle(inner);
              const fontFamily = innerStyle.fontFamily || 'Cairo';
              const fontWeight = innerStyle.fontWeight || '700';
              
              // Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
              let size = parseFloat(innerStyle.fontSize) || 11;
              const minSize = 3;
              
              // Ù‚Ø³ Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø¨Ø¯Ù‚Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Canvas
              let textWidth = measureTextWidth(originalText, size, fontFamily, fontWeight);
              
              false && console.log(`ğŸ” Cell ${idx}: text="${originalText}", maxWidth=${maxWidth.toFixed(2)}px, textWidth=${textWidth.toFixed(2)}px, fontSize=${size}px`);
              
              // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø­ØŒ ØµØºÙ‘Ø± Ø§Ù„Ø®Ø·
              if(textWidth > maxWidth){
                const ratio = textWidth / maxWidth;
                false && console.log(`ğŸ“ Cell ${idx} needs shrinking: ratio=${ratio.toFixed(2)}`);
                
                // Ø§Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©
                size = Math.max(minSize, (size / ratio) * 0.92); // 0.92 Ù„Ù„Ø£Ù…Ø§Ù†
                inner.style.fontSize = size + 'px';
                
                // Ø£Ø¹Ø¯ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¹Ø±Ø¶
                textWidth = measureTextWidth(originalText, size, fontFamily, fontWeight);
                
                false && console.log(`ğŸ“ After calculation: fontSize=${size.toFixed(2)}px, textWidth=${textWidth.toFixed(2)}px`);
                
                // ØªØ­Ø³ÙŠÙ† Ø¯Ù‚ÙŠÙ‚ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                let guard = 0;
                while(textWidth > maxWidth && size > minSize && guard < 30){
                  size -= 0.15;
                  guard++;
                  textWidth = measureTextWidth(originalText, size, fontFamily, fontWeight);
                }
                
                inner.style.fontSize = size + 'px';
                
                if(guard > 0){
                  false && console.log(`ğŸ”§ Fine-tuned ${guard} times, final: fontSize=${size.toFixed(2)}px, textWidth=${textWidth.toFixed(2)}px`);
                }
              }
              
              // Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ØŒ Ø£Ø®ÙÙ Ø§Ù„ØªØ¬Ø§ÙˆØ²
              td.style.overflow = 'hidden';
              processedCount++;
            });
            
            false && console.log(`âœ¨ Processed ${processedCount} numeric cells`);
          }catch(e){ 
            false && console.error('âŒ autoshrinkNumericCells error:', e);
          }
        }

        // ØªØµØºÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø®Ø· Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function autoshrinkProductNames(root){
          try{
            const cells = (root||document).querySelectorAll('tbody td.product-name');
            cells.forEach(td => {
              // Ø£Ø¹ÙØ¯ Ø§Ù„Ø®Ø· Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙŠØ§Ø³
              td.style.fontSize = '';
              td.style.lineHeight = '';
              const maxWidth = td.clientWidth;
              if(!maxWidth || maxWidth <= 0) return;
              
              // Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù†Øµ
              const tempSpan = document.createElement('span');
              tempSpan.style.visibility = 'hidden';
              tempSpan.style.position = 'absolute';
              tempSpan.style.whiteSpace = 'nowrap';
              tempSpan.style.fontSize = getComputedStyle(td).fontSize;
              tempSpan.style.fontFamily = getComputedStyle(td).fontFamily;
              tempSpan.style.fontWeight = getComputedStyle(td).fontWeight;
              tempSpan.textContent = td.textContent;
              document.body.appendChild(tempSpan);
              
              const textWidth = tempSpan.scrollWidth;
              document.body.removeChild(tempSpan);
              
              // Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
              const estimatedLines = Math.ceil(textWidth / maxWidth);
              
              // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ Ø³ÙŠØ£Ø®Ø° Ø£ÙƒØ«Ø± Ù…Ù† Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ØŒ ØµØºÙ‘Ø± Ø§Ù„Ø®Ø·
              if(estimatedLines > 1){
                let size = parseFloat(getComputedStyle(td).fontSize) || 11;
                const minSize = 7.5;
                
                // ØªØµØºÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
                // Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø³Ø·Ø±ÙŠÙ†: ØµØºÙ‘Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹
                // Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ 3+ Ø£Ø³Ø·Ø±: ØµØºÙ‘Ø± Ø£ÙƒØ«Ø±
                if(estimatedLines === 2){
                  size = Math.max(minSize, size * 0.85);
                } else if(estimatedLines === 3){
                  size = Math.max(minSize, size * 0.75);
                } else {
                  size = Math.max(minSize, size * 0.65);
                }
                
                td.style.fontSize = size + 'px';
                td.style.lineHeight = '1.1';
              }
            });
          }catch(_){ /* ignore */ }
        }

        // Ù†ÙÙ‘Ø° Ø§Ù„ØªØµØºÙŠØ± Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆÙ‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©ØŒ ÙˆØ£ÙŠØ¶Ù‹Ø§ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙˆÙ„
        window.addEventListener('load', ()=>{
          autoshrinkNumericCells();
          autoshrinkProductNames();
          setTimeout(()=> {
            autoshrinkNumericCells();
            autoshrinkProductNames();
          }, 5);
        });
        window.addEventListener('resize', ()=> {
          autoshrinkNumericCells();
          autoshrinkProductNames();
        });
        window.addEventListener('beforeprint', ()=> {
          autoshrinkNumericCells();
          autoshrinkProductNames();
        });
        window.addEventListener('afterprint', ()=> {
          autoshrinkNumericCells();
          autoshrinkProductNames();
        });
        // helper to safely inject footer note
        function setFooterNote(settings){
          try{
            const note = (settings && settings.invoice_footer_note || '').trim();
            if(!note) return;
            const box = document.getElementById('qrBox');
            if(!box) return;
            const p = document.createElement('div');
            p.className = 'muted';
            p.style.margin = '8px 0';
            p.style.whiteSpace = 'pre-wrap';
            p.style.overflowWrap = 'anywhere';
            p.style.wordBreak = 'break-word';
            p.textContent = note;
            box.insertAdjacentElement('beforebegin', p);
          }catch(_){ /* ignore */ }
        }
        // Ø¥Ø²Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©/Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„
        function showLowStockBanner(){ /* Ù„Ù… ÙŠØ¹Ø¯ Ù‡Ù†Ø§Ùƒ ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */ }
        // data is expected in window.__PRINT_DATA injected via query or preload
        const params = new URLSearchParams(location.search);
        const saleId = Number(params.get('id'));
        try{
          const api = (window.opener && window.opener.api) ? window.opener.api : (window.api || {});
          
          // ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø´Ø¹Ø§Ø± Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²ÙŠ - ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
          const [s, st, lg] = await Promise.all([
            api.sales_get(saleId),
            api.settings_get(),
            api.settings_image_get()
          ]);
          const settings = (st && st.ok) ? st.item : {};
          window.__SETTINGS__ = settings; // Cache for silent print WhatsApp
          // Apply global print margins (mm) via CSS variables
          try{
            const ml = Math.max(0, Number(settings.print_margin_left_mm||0));
            const mr = Math.max(0, Number(settings.print_margin_right_mm||0));
            document.documentElement.style.setProperty('--m-left', ml + 'mm');
            document.documentElement.style.setProperty('--m-right', mr + 'mm');
          }catch(_){ /* ignore */ }
          // Update table headers from settings
          try{
            const unitPriceLabel = settings.unit_price_label || 'Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø©';
            const quantityLabel = settings.quantity_label || 'Ø¹Ø¯Ø¯';
            const thPrice = document.getElementById('thPrice');
            const thQty = document.getElementById('thQty');
            if(thPrice) thPrice.textContent = unitPriceLabel;
            if(thQty) thQty.textContent = quantityLabel;
          }catch(_){ /* ignore */ }
          const pay = params.get('pay') || '';
          const cash = Number(params.get('cash')||0);
          // Ø®Ø±ÙŠØ·Ø© Ø¹Ø±Ø¨ÙŠØ© Ù„Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
          const payLabels = { cash:'ÙƒØ§Ø´', card:'Ø´Ø¨ÙƒØ©', credit:'Ø¢Ø¬Ù„', mixed:'Ù…Ø®ØªÙ„Ø·', tamara:'ØªÙ…Ø§Ø±Ø§', tabby:'ØªØ§Ø¨ÙŠ', refund:'Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù†' };
          const payKey = pay || (s.sale?.payment_method || '');
          document.getElementById('invPay').textContent = payLabels[payKey] || payKey;
          // Show cashier name from URL param if present; otherwise fallback to localStorage
          try{
            let cashier = '';
            try{ cashier = String((params.get('cashier')||'').trim()); }catch(_){ cashier=''; }
            if(!cashier){
              const u = JSON.parse(localStorage.getItem('pos_user')||'null');
              if(u && (u.full_name || u.username)){
                cashier = u.full_name || u.username;
              }
            }
            if(cashier){
              const line = document.getElementById('userLine');
              const span = document.getElementById('cashierName');
              if(span){ span.textContent = cashier; }
              if(line){ line.hidden = false; }
            }
          }catch(_){ /* ignore */ }
          if(!s || !s.ok){ document.body.innerHTML = '<div style="padding:12px">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>'; return; }
          const sale = s.sale, items = s.items || [];
          window.__SALE_DATA__ = sale;
          
          // ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„ØºØ±ÙØ© Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²ÙŠ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©)
          const roomId = params.get('room');
          const hasVat = Number(sale.vat_total||0) > 0;
          const needsCustomer = sale.customer_id && hasVat;
          
          const [customerData, roomData] = await Promise.all([
            needsCustomer ? api.customers_get(sale.customer_id) : Promise.resolve(null),
            roomId ? api.rooms_list() : Promise.resolve(null)
          ]);
          
          // set order number if available
          try{
            // Ø¥Ø°Ø§ ØªÙ… ØªÙ…Ø±ÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ø£ÙˆÙ„Ø§Ù‹ ÙˆØ¥Ù„Ø§ Ø®Ø° Ù…Ù† Ø§Ù„Ø³Ø¬Ù„
            let ord = 0;
            try{ ord = Number(params.get('order')||0); }catch(_){ ord = 0; }
            if(!ord){ try{ ord = Number(sale.order_no||0); }catch(_){ ord = 0; } }
            if(ord>0){ const el = document.getElementById('orderNo'); if(el){ el.textContent = String(ord); } }
          }catch(_){ }

          // driver block - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…ØªØ§Ø­Ø© Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ sale Ø³ÙˆØ§Ø¡ Ù…Ù† DB Ø£Ùˆ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
          try{
            if(sale.driver_name || sale.driver_phone){
              const box = document.getElementById('driverCard');
              box.style.display='block';
              document.getElementById('drvName').textContent = sale.driver_name || '';
              if(sale.driver_phone){
                const ph = document.getElementById('drvPhone');
                ph.style.display='';
                const spans = ph.querySelectorAll('span');
                if(spans && spans.length > 1){
                  spans[1].textContent = sale.driver_phone; // Ø¶Ø¹ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ù€ span Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙˆØ£Ø¨Ù‚Ù Ø§Ù„ØªØ³Ù…ÙŠØ©
                } else {
                  ph.textContent = 'Ø¬ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚: ' + sale.driver_phone;
                }
              }
            }
          }catch(_){}

          // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ© (ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹)
          if(roomData && roomData.ok){
            try{
              const R = (roomData.items||[]).find(x => String(x.id)===String(roomId));
              if(R){
                document.getElementById('roomName').textContent = R.name;
                document.getElementById('roomLine').hidden = false;
              }
            }catch(_){ }
          }

          // Ø§Ù„Ù†ÙˆØ¹ Ø£Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹)
          try{
            const typeEl = document.getElementById('invType');
            let isTax = false;
            // Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ø£Ø¸Ù‡Ø± Ø§Ù„ÙˆØ³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ø¨ÙˆØ¶ÙˆØ­
            if(String(sale.invoice_no||'').startsWith('CN-') || String(sale.doc_type||'')==='credit_note'){
              // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø¶Ø±ÙŠØ¨Ø© ÙˆÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„
              const baseNo = params.get('base_no') || sale.ref_base_invoice_no || '';
              const cn = String(sale.invoice_no||'');
              const hasVatAbs = Math.abs(Number(sale.vat_total||0)) > 0;
              let label = 'Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù†';
              let hasCustomerVat = false;
              if(customerData && customerData.ok && customerData.item && customerData.item.vat_number){ 
                hasCustomerVat = true; 
              }
              if(hasVatAbs){ label = hasCustomerVat ? 'Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ù„Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©' : 'Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ù„Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…Ø¨Ø³Ø·Ø©'; }
              typeEl.textContent = label;
              // Ø£Ø¶Ù Ø³Ø·Ø±Ù‹Ø§ ØªØ­ØªÙ‡ Ù„Ø¹Ø±Ø¶ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±/Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¥Ù† ÙˆÙØ¬Ø¯Øª
              const below = document.createElement('div');
              below.className = 'muted'; below.style.marginTop='4px'; below.style.fontSize='12px';
              const cnNum = cn.replace(/^CN-?/i, '');
              below.textContent = baseNo ? `Ø±Ù‚Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${cnNum} â€” Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: ${baseNo}` : `Ø±Ù‚Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${cnNum}`;
              typeEl.parentElement.appendChild(below);
              typeEl.style.display = '';
            } else {
              if(hasVat){
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¶Ø±ÙŠØ¨Ø©: Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ù…Ø¨Ø³Ø·Ø©
                isTax = true;
                typeEl.textContent = 'ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ© Ù…Ø¨Ø³Ø·Ø©';
              }
              // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 0 Ù„Ø§ ØªØ³ØªØ¹Ù„Ù… Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
              if(hasVat && customerData && customerData.ok && customerData.item && customerData.item.vat_number){
                isTax = true;
                typeEl.textContent = 'ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©';
              }
              typeEl.style.display = isTax ? '' : 'none';
            }
            // Ø¥Ù† ÙƒØ§Ù†Øª Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© = 0 ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø£Ø®ÙÙ ÙˆØ³Ù… Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©
            try{ if(Number(settings?.vat_percent||0) === 0){ typeEl.style.display = 'none'; } }catch(_){ }
          }catch(_){ /* ignore */ }

          function fmt(a){
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆÙ…ÙˆÙ‚Ø¹Ù‡ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            const n = Number(a||0).toFixed(2);
            try{
              let sym = String((settings && settings.currency_symbol) || '').trim();
              if(!sym){ sym = 'ï·¼'; }
              // Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø®Ø§Øµ Ù„Ù„Ø®Ø· Ø§Ù„Ù…Ø¶Ù…Ù‘Ù† Ø¥Ù† Ù„Ø²Ù…
              // Fix double symbols: if it looks like Saudi Riyal (including the symbol itself), force single symbol
              if(/ï·¼|SAR|SR|Ø±ÙŠØ§Ù„|Ø±\.Ø³|\uE900/i.test(sym)){ sym = '\ue900'; }
              const symHtml = `<span class="currency-symbol" style="font-size:13px;font-family:'saudi_riyal',sans-serif;line-height:1;vertical-align:middle;">${sym}</span>`;
              const pos = (settings && settings.currency_symbol_position) === 'before' ? 'before' : 'after';
              return pos === 'before' ? `${symHtml} ${n}` : `${n} ${symHtml}`;
            }catch(_){
              return n;
            }
          }

          // company area (prefer legal name for ZATCA)
          document.getElementById('company').textContent = (settings.seller_legal_name || '');
          const infoLines = [];
          if(settings.company_location) infoLines.push(settings.company_location);
          if(settings.company_site) infoLines.push(settings.company_site);
          if(settings.mobile) infoLines.push('Ø¬ÙˆØ§Ù„: '+settings.mobile);
          if(settings.email && (typeof settings.show_email_in_invoice === 'undefined' || settings.show_email_in_invoice)) infoLines.push('Ø¥ÙŠÙ…ÙŠÙ„: '+settings.email);
          if(settings.seller_vat_number) infoLines.push('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ: '+settings.seller_vat_number);
          if(settings.commercial_register) infoLines.push('Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ: '+settings.commercial_register);
          if(settings.national_number) infoLines.push('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ: '+settings.national_number);
          document.getElementById('companyInfo').textContent = infoLines.join('\n');

          // insert persistent footer note before QR
          setFooterNote(settings);

          // logo (already loaded in parallel) + apply size
          const logoEl = document.getElementById('logo');
          try{
            if(lg && lg.ok && lg.base64){
              logoEl.src = `data:${lg.mime||'image/png'};base64,${lg.base64}`;
            } else if(settings.logo_path){
              if(settings.logo_path.startsWith('assets/')){
                logoEl.src='../../../'+settings.logo_path; // from src/renderer/sales -> project/assets
              }else{
                logoEl.src='file:///'+settings.logo_path.replace(/\\/g,'/');
              }
            } else {
              logoEl.style.display='none';
            }
            const lw = Number(settings.logo_width_px||0), lh = Number(settings.logo_height_px||0);
            if(lw>0){ logoEl.style.width = lw + 'px'; }
            if(lh>0){ logoEl.style.height = lh + 'px'; }
          }catch(_){ logoEl.style.display='none'; }

          // sale meta
          // Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
          const baseNo = params.get('base_no') || sale.ref_base_invoice_no || '';
          if(String(sale.doc_type||'')==='credit_note' || String(sale.invoice_no||'').startsWith('CN-')){
            // ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: Ø£Ø¸Ù‡Ø± Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            if(baseNo){ document.getElementById('invNo').textContent = baseNo; }
          } else {
            document.getElementById('invNo').textContent = sale.invoice_no;
          }
          // Force Gregorian calendar in English (Gregorian)
          // 12-hour time with AM/PM in English
          const enGreg = new Intl.DateTimeFormat('en-GB-u-ca-gregory', { year:'numeric', month:'2-digit', day:'2-digit', hour:'numeric', minute:'2-digit', hour12:true }).format(new Date(sale.created_at));
          document.getElementById('invDate').textContent = enGreg;
          // Show paid timestamp if settled
          // Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ…Ø© ÙÙŠ settled_at (Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø£Ù‚Ù„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚Ø©)
          if(sale.settled_at){
            try{
              const paidFmt = new Intl.DateTimeFormat('en-GB-u-ca-gregory', { year:'numeric', month:'2-digit', day:'2-digit', hour:'numeric', minute:'2-digit', hour12:true }).format(new Date(sale.settled_at));
              document.getElementById('paidAt').textContent = paidFmt;
              document.getElementById('paidAtLine').style.display = '';
            }catch(_){ }
          }
          // ÙƒØ§Ù† ÙŠØ¸Ù‡Ø± Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‡Ù†Ø§ØŒ Ù†Ù‚Ù„Ù†Ø§Ù‡ Ø¥Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø·

          // Hook export button to export thermal layout as PDF
          try{
            const exportBtn = document.getElementById('exportBtn');
            if(exportBtn){
              exportBtn.addEventListener('click', async () => {
                try{
                  // Clone current DOM, strip scripts/buttons to keep static values
                  const root = document.documentElement.cloneNode(true);
                  Array.from(root.querySelectorAll('script')).forEach(s=>s.remove());
                  Array.from(root.querySelectorAll('.reprint-btn, .export-btn, .whats-btn')).forEach(el=>el.remove());
                  // Ensure logo uses absolute file path so it appears in PDF
                  try{
                    const img = root.querySelector('#logo');
                    if(img){
                      let absLogo = '';
                      if(settings.logo_path){
                        if(String(settings.logo_path).startsWith('assets/')){
                          const rp = await api.resolve_path(settings.logo_path);
                          if(rp && rp.ok){ absLogo = 'file:///' + String(rp.abs||'').replace(/\\/g,'/'); }
                        }else{
                          absLogo = 'file:///' + String(settings.logo_path||'').replace(/\\/g,'/');
                        }
                      }
                      if(absLogo){ img.src = absLogo; }
                    }
                  }catch(_){ }
                  const html = '<!doctype html>' + root.outerHTML;
                  const fname = `invoice-${sale.invoice_no}.pdf`;
                  const r = await api.pdf_export(html, { printBackground: true, saveMode: 'auto', filename: fname });
                  if(!r || !r.ok){ alert('ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ PDF Ù„Ù„ÙØ§ØªÙˆØ±Ø©'); }
                }catch(e){ alert('ÙØ´Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF'); }
              });
            }

            // WhatsApp button handler
            try{
              const whatsBtn = document.getElementById('whatsBtn');
              if(whatsBtn){
                whatsBtn.addEventListener('click', () => {
                  (async () => {
                    try{
                      if(window.__WA_SENDING__){
                        alert('â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©... Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±');
                        return;
                      }

                      if(!navigator.onLine){
                        if(typeof window.showWhatsAppErrorNotification === 'function'){
                          window.showWhatsAppErrorNotification('no-internet', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹');
                        } else {
                          alert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª!\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                        }
                        return;
                      }

                      const statusCheck = await api.whatsapp_status();
                      if(!statusCheck || !statusCheck.success || !statusCheck.connected){
                        if(typeof window.showWhatsAppErrorNotification === 'function'){
                          window.showWhatsAppErrorNotification('not-connected', 'ÙŠØ±Ø¬Ù‰ Ø±Ø¨Ø· WhatsApp Ø£ÙˆÙ„Ø§Ù‹');
                        } else {
                          alert('âŒ WhatsApp ØºÙŠØ± Ù…ØªØµÙ„!\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© WhatsApp ÙˆØ±Ø¨Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.\n\nØªØ£ÙƒØ¯ Ù…Ù†:\nâ€¢ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\nâ€¢ Ù…Ø³Ø­ Ø±Ù…Ø² QR ÙÙŠ Ø´Ø§Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© WhatsApp');
                        }
                        return;
                      }

                      let rawPhone = String(window.__CUST_PHONE__ || '').trim();
                      if(/^05\d{8}$/.test(rawPhone)){ 
                        rawPhone = '966' + rawPhone.slice(1); 
                      }
                      rawPhone = rawPhone.replace(/[^\d+]/g,'');
                      if(!rawPhone){ 
                        alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„'); 
                        return; 
                      }

                      window.__WA_SENDING__ = true;
                      false && console.log('â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©...');

                      (async () => {
                        try{
                          const root = document.documentElement.cloneNode(true);
                          Array.from(root.querySelectorAll('script')).forEach(s=>s.remove());
                          Array.from(root.querySelectorAll('.reprint-btn, .export-btn, .whats-btn')).forEach(el=>el.remove());
                          
                          try{
                            const img = root.querySelector('#logo');
                            if(img && settings.logo_path){
                              let absLogo = '';
                              if(String(settings.logo_path).startsWith('assets/')){
                                const rp = await api.resolve_path(settings.logo_path);
                                if(rp && rp.ok){ 
                                  absLogo = 'file:///' + String(rp.abs||'').replace(/\\/g,'/'); 
                                }
                              }else{
                                absLogo = 'file:///' + String(settings.logo_path||'').replace(/\\/g,'/');
                              }
                              if(absLogo){ img.src = absLogo; }
                            }
                          }catch(_){ }

                          const html = '<!doctype html>' + root.outerHTML;
                          const fname = `invoice-${sale.invoice_no}.pdf`;
                          
                          const pdfResult = await api.pdf_export(html, { 
                            printBackground: true, 
                            saveMode: 'temp', 
                            filename: fname
                          });
                          
                          if(!pdfResult || !pdfResult.ok){ 
                            false && console.error('âŒ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ PDF Ù„Ù„ÙØ§ØªÙˆØ±Ø©');
                            alert('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF Ù„Ù„ÙØ§ØªÙˆØ±Ø©');
                            return; 
                          }

                          false && console.log('PDF created temporarily at:', pdfResult.path);
                          const company = (settings && settings.seller_legal_name) ? 
                                         settings.seller_legal_name : 'ÙØ§ØªÙˆØ±Ø©';
                          const invNo = String(sale.invoice_no||'');
                          const caption = `ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ${invNo} Ù…Ù† ${company}`;
                          
                          false && console.log('Sending to phone:', rawPhone);
                          
                          // Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ (1-8 Ø«ÙˆØ§Ù†ÙŠ) Ù„ØªÙ‚Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø­Ø¸Ø±
                          false && console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...');
                          await randomDelay(1000, 8000);
                          false && console.log('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...');
                          
                          const sendResult = await api.whatsapp_send_file(
                            rawPhone, 
                            pdfResult.path, 
                            fname, 
                            caption
                          );

                          if(sendResult && sendResult.success){
                            false && console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± WhatsApp Ø¨Ù†Ø¬Ø§Ø­!');
                            alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± WhatsApp Ø¨Ù†Ø¬Ø§Ø­!');
                            
                            try {
                              if(typeof api !== 'undefined' && api.emit_whatsapp_invoice_sent){
                                api.emit_whatsapp_invoice_sent({
                                  message: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¹Ù…ÙŠÙ„',
                                  invoiceNo: invNo
                                });
                              }
                            } catch(_) {}
                          } else {
                            const errMsg = sendResult?.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                            false && console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', errMsg);
                            alert('âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ' + errMsg);
                          }
                          
                          // Clean up temp PDF after sending
                          try {
                            await api.file_delete(pdfResult.path);
                            false && console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª');
                          } catch(_) {}

                        }catch(e){ 
                          false && console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', e);
                          alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ' + (e.message || e));
                        } finally {
                          window.__WA_SENDING__ = false;
                        }
                      })();

                    }catch(e){ 
                      false && console.error('WhatsApp validation error:', e);
                      alert('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª WhatsApp: ' + (e.message || e)); 
                    }
                  })();
                });
              }
            }catch(_){ }
          }catch(_){ /* ignore */ }

          // ØªØµØºÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ù‚Ø¨Ù„ ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
          try{
            false && console.log('ğŸš€ Starting autoshrink sequence...');
            
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙÙˆØ±ÙŠ Ø£ÙˆÙ„
            false && console.log('ğŸ“ Call 1: immediate');
            autoshrinkNumericCells();
            autoshrinkProductNames();
            
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø¨ØªØ£Ø®ÙŠØ±Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            setTimeout(()=>{
              false && console.log('ğŸ“ Call 2: after 0ms');
              autoshrinkNumericCells();
              autoshrinkProductNames();
            }, 0);
            
            setTimeout(()=>{
              false && console.log('ğŸ“ Call 3: after 20ms');
              autoshrinkNumericCells();
              autoshrinkProductNames();
            }, 20);
            
            setTimeout(()=>{
              false && console.log('ğŸ“ Call 4: after 50ms');
              autoshrinkNumericCells();
              autoshrinkProductNames();
            }, 50);
            
            setTimeout(()=>{
              false && console.log('ğŸ“ Call 5: after 100ms');
              autoshrinkNumericCells();
              autoshrinkProductNames();
            }, 100);
            
            setTimeout(()=>{
              false && console.log('ğŸ“ Call 6: after 200ms (final)');
              autoshrinkNumericCells();
              autoshrinkProductNames();
            }, 200);
          }catch(_){ /* ignore */ }

          // After building invoice content, resize preview window to fit
          resizeWindowToTicket();

          // Check and notify parent window about WhatsApp status
          try{
            if(settings && settings.whatsapp_on_print){
              const urlParams = new URLSearchParams(window.location.search);
              const isReprint = urlParams.get('reprint') === '1';
              
              if(!isReprint){
                (async () => {
                  try{
                    if(!navigator.onLine){
                      if(window.opener && typeof window.opener.showWhatsAppErrorNotification === 'function'){
                        window.opener.showWhatsAppErrorNotification('no-internet', 'Ù„Ù† ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨');
                      }
                    } else {
                      const statusCheck = await api.whatsapp_status();
                      if(!statusCheck || !statusCheck.success || !statusCheck.connected){
                        if(window.opener && typeof window.opener.showWhatsAppErrorNotification === 'function'){
                          window.opener.showWhatsAppErrorNotification('not-connected', 'Ù„Ù† ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨');
                        }
                      }
                    }
                  }catch(_){}
                })();
              }
            }
          }catch(_){}

          // Auto-send PDF to WhatsApp after manual print completes
          try{
            if(settings && settings.whatsapp_on_print){
              // Check if this is the first copy (to avoid sending duplicate WhatsApp messages)
              const urlParams = new URLSearchParams(window.location.search);
              const copyNumber = urlParams.get('copy');
              const isReprint = urlParams.get('reprint') === '1';
              const isFirstCopy = !copyNumber || copyNumber === '1';
              
              if(isReprint){
                false && console.log('â­ï¸ Skipping WhatsApp afterprint handler for reprint');
              } else if(!isFirstCopy){
                false && console.log(`â­ï¸ Skipping WhatsApp afterprint handler for copy #${copyNumber}`);
              } else {
                const timestamp = Date.now();
                false && console.log(`ğŸ”§ [${timestamp}] Registering WhatsApp afterprint handler (copy #${copyNumber || '1'})`);
                
                window.addEventListener('afterprint', async () => {
                const eventTime = Date.now();
                false && console.log(`ğŸ”” [${eventTime}] afterprint event fired! (${eventTime - timestamp}ms after registration)`);
                
                // Check if already sent or sending
                if(window.__WA_SENT__ || window.__WA_SENDING__){
                  false && console.log(`â­ï¸ [${eventTime}] WhatsApp send already in progress or completed, skipping (SENT=${window.__WA_SENT__}, SENDING=${window.__WA_SENDING__})`);
                  return;
                }
                
                window.__WA_SENDING__ = true;
                window.__WA_SENT__ = true;
                false && console.log(`â³ [${eventTime}] Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©...`);
                
                try{
                  // Verify content is ready
                  if(!window.__CONTENT_READY__){
                    false && console.log('âš ï¸ Content not ready, skipping WhatsApp send');
                    window.__WA_SENDING__ = false;
                    window.__WA_SENT__ = false;
                    return;
                  }

                  if(!navigator.onLine){
                    console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨');
                    if(typeof window.showWhatsAppErrorNotification === 'function'){
                      window.showWhatsAppErrorNotification('no-internet', 'Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹');
                    }
                    window.__WA_SENDING__ = false;
                    window.__WA_SENT__ = false;
                    return;
                  }

                  const statusCheck = await api.whatsapp_status();
                  if(!statusCheck || !statusCheck.success || !statusCheck.connected){
                    console.error('âŒ WhatsApp not connected, skipping auto-send');
                    if(typeof window.showWhatsAppErrorNotification === 'function'){
                      window.showWhatsAppErrorNotification('not-connected', 'Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹');
                    }
                    window.__WA_SENDING__ = false;
                    window.__WA_SENT__ = false;
                    return;
                  }

                  let rawPhone = String(window.__CUST_PHONE__ || '').trim();
                  if(/^05\d{8}$/.test(rawPhone)){ 
                    rawPhone = '966' + rawPhone.slice(1); 
                  }
                  rawPhone = rawPhone.replace(/[^\d+]/g,'');
                  if(!rawPhone){ 
                    false && console.log('âŒ No customer phone, skipping WhatsApp send');
                    window.__WA_SENDING__ = false;
                    window.__WA_SENT__ = false;
                    return; 
                  }

                  false && console.log(`ğŸ“„ [${Date.now()}] Creating PDF for invoice... (invoice_no: ${sale.invoice_no})`);
                  false && console.log(`ğŸ“Š [${Date.now()}] DOM has ${document.querySelectorAll('#items tr').length} item rows`);
                  const root = document.documentElement.cloneNode(true);
                  false && console.log(`ğŸ“‹ [${Date.now()}] Cloned DOM has ${root.querySelectorAll('#items tr').length} item rows`);
                  Array.from(root.querySelectorAll('script')).forEach(s=>s.remove());
                  Array.from(root.querySelectorAll('.reprint-btn, .export-btn, .whats-btn')).forEach(el=>el.remove());
                  
                  try{
                    const img = root.querySelector('#logo');
                    if(img && settings.logo_path){
                      let absLogo = '';
                      if(String(settings.logo_path).startsWith('assets/')){
                        const rp = await api.resolve_path(settings.logo_path);
                        if(rp && rp.ok){ 
                          absLogo = 'file:///' + String(rp.abs||'').replace(/\\/g,'/'); 
                        }
                      }else{
                        absLogo = 'file:///' + String(settings.logo_path||'').replace(/\\/g,'/');
                      }
                      if(absLogo){ img.src = absLogo; }
                    }
                  }catch(_){ }

                  const html = '<!doctype html>' + root.outerHTML;
                  const fname = `invoice-${sale.invoice_no}.pdf`;
                  
                  false && console.log(`ğŸ“ [${Date.now()}] Generating PDF with filename: ${fname}`);
                  const pdfResult = await api.pdf_export(html, { 
                    printBackground: true, 
                    saveMode: 'temp', 
                    filename: fname
                  });
                  
                  if(!pdfResult || !pdfResult.ok){ 
                    false && console.error('âŒ Failed to generate PDF for auto-send');
                    window.__WA_SENDING__ = false;
                    window.__WA_SENT__ = false;
                    return; 
                  }

                  false && console.log(`âœ… [${Date.now()}] PDF generated at: ${pdfResult.path}`);
                  const company = (settings && settings.seller_legal_name) ? 
                                 settings.seller_legal_name : 'ÙØ§ØªÙˆØ±Ø©';
                  const invNo = String(sale.invoice_no||'');
                  const caption = `ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ${invNo} Ù…Ù† ${company}`;
                  
                  false && console.log(`ğŸ“¤ [${Date.now()}] Sending PDF via WhatsApp to: ${rawPhone}`);
                  false && console.log(`ğŸ“¤ [${Date.now()}] File path: ${pdfResult.path}`);
                  false && console.log(`ğŸ“¤ [${Date.now()}] File name: ${fname}`);
                  
                  // Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ (1-8 Ø«ÙˆØ§Ù†ÙŠ) Ù„ØªÙ‚Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø­Ø¸Ø±
                  false && console.log(`â³ [${Date.now()}] Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ...`);
                  await randomDelay(1000, 8000);
                  false && console.log(`âœ… [${Date.now()}] Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...`);
                  
                  const sendResult = await api.whatsapp_send_file(
                    rawPhone, 
                    pdfResult.path, 
                    fname, 
                    caption
                  );

                  if(sendResult && sendResult.success){
                    console.log(`âœ… [${Date.now()}] ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ù†Ø¬Ø§Ø­!`);
                    
                    try {
                      if(typeof api !== 'undefined' && api.emit_whatsapp_invoice_sent){
                        api.emit_whatsapp_invoice_sent({
                          message: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¹Ù…ÙŠÙ„',
                          invoiceNo: invNo
                        });
                      }
                    } catch(_) {}
                  } else {
                    const errorMsg = sendResult?.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    console.error(`âŒ [${Date.now()}] ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:`, errorMsg);
                    if(typeof window.showWhatsAppErrorNotification === 'function'){
                      const reason = errorMsg.includes('not connected') || errorMsg.includes('ØºÙŠØ± Ù…ØªØµÙ„') ? 'not-connected' : 'no-internet';
                      window.showWhatsAppErrorNotification(reason, 'ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© - ' + errorMsg);
                    }
                  }
                  
                  // Clean up temp PDF
                  false && console.log(`ğŸ—‘ï¸ [${Date.now()}] Cleaning up temp file...`);
                  try {
                    await api.file_delete(pdfResult.path);
                    false && console.log(`âœ… [${Date.now()}] Temp file deleted`);
                  } catch(_) {
                    false && console.log(`âš ï¸ [${Date.now()}] Failed to delete temp file`);
                  }
                }catch(e){ 
                  const errorMsg = e?.message || String(e);
                  console.error(`âŒ [${Date.now()}] Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨:`, e);
                  if(typeof window.showWhatsAppErrorNotification === 'function'){
                    const reason = errorMsg.includes('not connected') || errorMsg.includes('ØºÙŠØ± Ù…ØªØµÙ„') ? 'not-connected' : 'no-internet';
                    window.showWhatsAppErrorNotification(reason, 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© - ' + errorMsg);
                  }
                  window.__WA_SENDING__ = false;
                  window.__WA_SENT__ = false;
                }finally{
                  false && console.log(`ğŸ [${Date.now()}] WhatsApp send handler finished`);
                  window.__WA_SENDING__ = false;
                }
              }, { once: true });
              }
            }
          }catch(_){ /* ignore */ }

          // If logo loads later and changes height, resize again
          try{
            const logo = document.getElementById('logo');
            if(logo){ logo.addEventListener('load', ()=>setTimeout(resizeWindowToTicket, 5), { once:true }); }
          }catch(_){ }

          // Reprint button: if silent_print enabled, override inline onclick to avoid dialog
          try{
            const reBtn = document.getElementById('reprintBtn');
            if(reBtn && settings && settings.silent_print){
              reBtn.onclick = async (ev) => {
                ev.preventDefault(); ev.stopPropagation();
                try{
                  const roomParam = params.get('room') || '';
                  const copies = Math.max(1, Number(settings.print_copies || (settings.print_two_copies ? 2 : 1)));
                  for(let i=1;i<=copies;i++){
                    let cashier = '';
                    try{ const u = JSON.parse(localStorage.getItem('pos_user')||'null'); if(u && (u.full_name || u.username)){ cashier = u.full_name || u.username; } }catch(_){ }
                    await api.print_invoice_silent({ id: saleId, pay: (pay || (s.sale?.payment_method || '')), cash: String(cash), room: roomParam, format: 'thermal', cashier });
                  }
                  // ØªÙ… Ø­Ø°Ù ÙƒÙˆØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØµÙŠØ© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
                }catch(_){ /* ignore */ }
                return false;
              };
            }
          }catch(_){ /* ignore */ }

          // customer card block (nice layout)
          try{
            const card = document.getElementById('custCard');
            const ccName = document.getElementById('ccName');
            const ccPhone = document.getElementById('ccPhone');
            const ccEmail = document.getElementById('ccEmail');
            const ccAddress = document.getElementById('ccAddress');
            const ccVat = document.getElementById('ccVat');
            const ccCR = document.getElementById('ccCR');
            const ccNat = document.getElementById('ccNat');
            const ccNotes = document.getElementById('ccNotes');
            
            console.log('ğŸ” Checking customer data:', { customer_id: sale.customer_id, customer_name: sale.customer_name });
            
            if(sale.customer_id){
              // ğŸš€ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªÙˆÙØ± customer_idØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù‚Ø·Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
              let customerData = null;
              // Use the same api instance that already falls back to window.api
              console.log('ğŸ“¡ Fetching customer from API:', sale.customer_id);
              const c = await api.customers_get(sale.customer_id);
              console.log('ğŸ“¡ API Response:', c);
              if(c && c.ok && c.item){
                customerData = c.item;
                console.log('âœ… Got customer data from API:', customerData);
              } else {
                console.warn('âš ï¸ Failed to get customer data from API');
              }
              if(!customerData && sale.customer_name){
                customerData = {
                  name: sale.customer_name,
                  phone: sale.customer_phone,
                  email: sale.customer_email,
                  address: sale.customer_address,
                  vat_number: sale.customer_vat_number || sale.customer_vat,
                  cr_number: sale.customer_cr_number,
                  national_address: sale.customer_national_address,
                  notes: sale.customer_notes
                };
                console.log('âœ… Using fast data for customer:', customerData);
              }
              
              if(customerData){
                const { name, phone, email, address, vat_number, cr_number, national_address, notes } = customerData;
                console.log('ğŸ“ Displaying customer card:', { name, phone, email, address, vat_number, cr_number });
                card.style.display='';
                // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø¹ ÙˆØ³Ù… "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"
                if(name){ ccName.textContent = 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ' + name; ccName.style.display=''; } else { ccName.style.display='none'; }
                if(phone){ ccPhone.style.display=''; ccPhone.querySelector('span').textContent = phone; }
                if(email){ ccEmail.style.display=''; ccEmail.querySelector('span').textContent = email; }
                if(address){ ccAddress.style.display=''; ccAddress.querySelector('span').textContent = address; }
                if(vat_number){ ccVat.style.display=''; ccVat.querySelector('span').textContent = vat_number; }
                if(cr_number){ ccCR.style.display=''; ccCR.querySelector('span').textContent = cr_number; }
                if(national_address){ ccNat.style.display=''; ccNat.querySelector('span').textContent = national_address; }
                if(notes){ ccNotes.style.display=''; ccNotes.querySelector('span').textContent = notes; }
                // Cache customer phone globally for WhatsApp button
                try{ window.__CUST_PHONE__ = (phone || '').trim(); }catch(_){ }
                // Auto WhatsApp: set initial flag
                try{ window.__WA_SENT__ = false; }catch(_){ }
              } else {
                console.warn('âš ï¸ No customer data found, hiding card');
                card.style.display='none';
              }
            } else {
              console.warn('âš ï¸ No customer_id in sale, hiding card');
              card.style.display='none';
            }
          }catch(err){ console.error('âŒ Error in customer card block:', err); }

          const tbody = document.getElementById('items');
          tbody.innerHTML = '';
          // Ø§Ø¶Ø¨Ø· Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ (Ø§Ù„Ø¹Ù…Ù„ÙŠØ©) Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø¥Ù† Ù„Ù… ØªÙˆØ¬Ø¯ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ©ØŒ Ø£Ø®ÙÙ Ø§Ù„Ø¹Ù…ÙˆØ¯ ÙˆÙˆØ³Ù‘Ø¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø®Ø±Ù‰
          try{
            const itemsTable = document.querySelector('.ticket > table:first-of-type');
            const hasOp = Array.isArray(items) && items.some(it => String(it.operation_name||'').trim() !== '');
            if(itemsTable){
              itemsTable.classList.remove('has-op','no-op');
              itemsTable.classList.add(hasOp ? 'has-op' : 'no-op');
            }
          }catch(_){ /* ignore */ }
          const isCredit = String(sale.doc_type||'')==='credit_note' || String(sale.invoice_no||'').startsWith('CN-');
          items.forEach(it => {
            // Ø³Ù†Ø¶ÙŠÙ Ø¹Ù†Ø§ØµØ± span Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„ØªÙØ§Ø¯ÙŠ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­ÙˆØ§Ù ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¥Ø°Ø§ Ù„Ø²Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹
            // Ø§Ù„ØµÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø¨Ù†Ø¯
            const tr = document.createElement('tr');
            tr.className = 'item-row';
            const opCell = it.operation_name ? it.operation_name : '';
            // ÙÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© â€” Ø§Ø¹Ø±Ø¶ Ù…ÙˆØ¬Ø¨Ø© Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†
            const priceVal = Number(it.price||0);
            const lineVal = Number(it.line_total||0);
            const dispPrice = isCredit ? Math.abs(priceVal) : priceVal;
            const dispLine = isCredit ? Math.abs(lineVal) : lineVal;
            // Normalize qty from possible Arabic digits and separators
            let rawQty = it.qty;
            let qtyNum = 0;
            try{
              let s = (rawQty==null ? '' : String(rawQty)).trim();
              if(s){
                const map = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9','Û°':'0','Û±':'1','Û²':'2','Û³':'3','Û´':'4','Ûµ':'5','Û¶':'6','Û·':'7','Û¸':'8','Û¹':'9','âˆ’':'-'};
                s = s.replace(/[Ù -Ù©Û°-Û¹âˆ’]/g, ch => map[ch] || ch);
                s = s.replace(/[\u200e\u200f\u202a-\u202e\u2066-\u2069]/g, ''); // strip bidi control chars
                s = s.replace(/[Ù¬\s]/g,''); // thousands/grouping
                s = s.replace(/[Ù«,]/g,'.');   // decimal to dot
                s = s.replace(/[^0-9.\-]/g,''); // keep only digits, dot, minus
                const t = parseFloat(s);
                qtyNum = Number.isFinite(t) ? t : (typeof rawQty === 'number' ? rawQty : Number(rawQty||0));
              } else {
                qtyNum = (typeof rawQty === 'number') ? rawQty : Number(rawQty||0);
              }
            }catch(_){ qtyNum = (typeof rawQty === 'number') ? rawQty : Number(rawQty||0); }
            qtyNum = isCredit ? Math.abs(qtyNum) : qtyNum;
            // Quantity: no decimals if integer; otherwise show exactly 3 decimals
            const qtyTxt = Number.isInteger(qtyNum) ? String(qtyNum) : qtyNum.toFixed(3);
            tr.innerHTML = `<td class="product-name">${it.name}</td><td>${opCell}</td><td class="num"><span class="num-inner">${dispPrice.toFixed(2)}</span></td><td class="num"><span class="num-inner">${qtyTxt}</span></td><td class="num"><span class="num-inner">${dispLine.toFixed(2)}</span></td>`;
            tbody.appendChild(tr);

            // ØµÙ Ù„Ù„ÙˆØµÙ ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ ÙŠØºØ·ÙŠ ÙƒØ§Ù…Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const trDesc = document.createElement('tr');
            trDesc.className = 'item-desc-row';
            const descExtra = Number(it.is_tobacco||0) ? `<span style='color:#b91c1c; font-weight:800; margin-inline-end:8px;'>Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù ÙŠØ·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡ Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ¨Øº</span>` : '';
            const empName = it.employee_name ? `<div style='font-size:9px; color:#64748b; margin-top:2px;'>Ø§Ù„Ù…ÙˆØ¸Ù: ${it.employee_name}</div>` : '';
            trDesc.innerHTML = (it.description || Number(it.is_tobacco||0) || it.employee_name)
              ? `<td colspan="5"><div class="desc-print">${descExtra}${it.description ? `<span class="desc-title">ÙˆØµÙ Ø§Ù„ØµÙ†Ù:</span> ${it.description}` : ''}${empName}</div></td>`
              : `<td colspan="5"></td>`;
            tbody.appendChild(trDesc);
          });

          document.getElementById('sub').innerHTML = fmt(isCredit ? Math.abs(Number(sale.sub_total||0)) : Number(sale.sub_total||0));
          // extra value row
          const extraVal = Number(sale.extra_value||0);
          if(extraVal > 0){
            document.getElementById('extraRow').style.display='';
            document.getElementById('extra').innerHTML = fmt(extraVal);
          }
          // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙÙ‚Ø·ØŒ ÙˆØ£Ø®ÙÙ ØµÙ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ù„Ù…Ù†Ø¹ Ø§Ù„Ø§Ø²Ø¯ÙˆØ§Ø¬ÙŠØ©
          if(Number(sale.discount_amount||0) > 0){
            document.getElementById('discRow').style.display='';
            const label = (sale.discount_type === 'amount') ? 'Ø®ØµÙ… Ù†Ù‚Ø¯ÙŠ' : 'Ø®ØµÙ…';
            document.getElementById('discLabel').textContent = label;
            const dispDisc = Math.abs(Number(sale.discount_amount||0));
            document.getElementById('disc').innerHTML = fmt(dispDisc);
          }
          const baseAfter = sale.total_after_discount ?? (Number(sale.sub_total||0) - Number(sale.discount_amount||0));
          document.getElementById('afterDisc').innerHTML = fmt(isCredit ? Math.abs(Number(baseAfter||0)) : Number(baseAfter||0));
          if(Number(sale.discount_amount||0) > 0){ document.getElementById('afterDiscRow').style.display=''; }
          try{ document.getElementById('couponRow').style.display='none'; }catch(_){ }
          // Ø¥Ø®ÙØ§Ø¡ ØµÙ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© = 0 ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          try{
            if(Number(settings?.vat_percent||0) === 0){
              const vatRow = document.getElementById('vat')?.closest('tr');
              if(vatRow){ vatRow.style.display = 'none'; }
              // Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø¨Ù…Ø§ ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¶Ø±ÙŠØ¨Ø©
              try{
                const subLabel = document.getElementById('sub')?.previousElementSibling;
                if(subLabel){ subLabel.textContent = 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹'; }
                const afterDiscRowEl = document.getElementById('afterDiscRow');
                if(afterDiscRowEl){ afterDiscRowEl.style.display = 'none'; }
                const grandLabel = document.getElementById('grand')?.previousElementSibling;
                if(grandLabel){ grandLabel.innerHTML = '<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</b>'; }
              }catch(_){ }
            }
          }catch(_){ /* ignore */ }

          // ÙÙŠ Ø­Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù†ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø®Ø²Ù†Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
          try{
            const isCredit = String(sale.doc_type||'')==='credit_note' || String(sale.invoice_no||'').startsWith('CN-');
            if(isCredit && !(Number(sale.discount_amount||0) > 0)){
              const baseId = Number(params.get('base')||0);
              let baseSale = null;
              if(baseId){ const br = await api.sales_get(baseId); if(br && br.ok){ baseSale = br.sale; } }
              if(!baseSale){
                const baseNo = params.get('base_no') || sale.ref_base_invoice_no || '';
                if(baseNo){
                  const lr = await api.sales_list({ invoice_no: baseNo });
                  if(lr && lr.ok && lr.items && lr.items.length){
                    const bid = lr.items[0].id;
                    const br2 = await api.sales_get(bid);
                    if(br2 && br2.ok){ baseSale = br2.sale; }
                  }
                }
              }
              if(baseSale){
                const bExtra = Number(baseSale.extra_value||0);
                const bDisc = Number(baseSale.discount_amount||0);
                if(bExtra > 0){
                  document.getElementById('extraRow').style.display='';
                  document.getElementById('extra').innerHTML = fmt(bExtra);
                }
                if(bDisc > 0){
                  document.getElementById('discRow').style.display='';
                  const blabel = (baseSale.discount_type === 'amount') ? 'Ø®ØµÙ… Ù†Ù‚Ø¯ÙŠ' : 'Ø®ØµÙ…';
                  document.getElementById('discLabel').textContent = blabel;
                  document.getElementById('disc').innerHTML = fmt(Math.abs(bDisc));
                  document.getElementById('afterDisc').innerHTML = fmt(Math.abs(baseSale.total_after_discount ?? (Number(baseSale.sub_total||0) - bDisc)));
                  document.getElementById('afterDiscRow').style.display='';
                }
              }
            }
          }catch(_){ }

          // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ¨Øº Ø¥Ù† ØªÙ… Ø­ÙØ¸Ù‡Ø§ Ø¶Ù…Ù† Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø³Ù„Ø©
          try{
            const feeRow = document.getElementById('tobaccoFeeRow');
            const feeVal = document.getElementById('tobaccoFee');
            // ÙÙŠ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†ØŒ ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ… Ø³Ø§Ù„Ø¨Ø©Ø› Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©
            const rawTf = Number(sale.tobacco_fee || 0);
            const tf = (String(sale.doc_type||'')==='credit_note' || String(sale.invoice_no||'').startsWith('CN-')) ? Math.abs(rawTf) : rawTf;
            if(feeRow && feeVal){
              if(tf > 0){
                feeRow.style.display='';
                try{
                  feeVal.innerHTML = fmt(tf);
                }catch(_){ feeVal.textContent = fmt(tf); }
              }
              else { feeRow.style.display='none'; feeVal.textContent=''; }
            }
          }catch(_){}
          document.getElementById('vat').innerHTML = fmt(isCredit ? Math.abs(Number(sale.vat_total||0)) : Number(sale.vat_total||0));
          document.getElementById('grand').innerHTML = fmt(isCredit ? Math.abs(Number(sale.grand_total||0)) : Number(sale.grand_total||0));

          // Ø¨Ø¹Ø¯ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø¶Ø¨Ø· ÙƒØ§ÙØ© Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
          autoshrinkNumericCells(document);
          autoshrinkProductNames(document);
          // ÙÙŠ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†: Ø§Ø¸Ù‡Ø± Ø§Ù„Ù‚ÙŠÙ… Ù…ÙˆØ¬Ø¨Ø© ÙÙŠ ØµÙ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠ/Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø£ÙŠØ¶Ø§Ù‹
          try{
            if(isCredit){
              const paidEl = document.getElementById('paid');
              const remEl = document.getElementById('remain');
              const changeEl = document.getElementById('change');
              if(paidEl){ paidEl.innerHTML = paidEl.textContent.replace('-',''); }
              if(remEl){ remEl.innerHTML = remEl.textContent.replace('-',''); }
              if(changeEl){ changeEl.innerHTML = changeEl.textContent.replace('-',''); }
            }
          }catch(_){ }

          // paid/remaining & notes
          try{
            const paidRow = document.getElementById('paidRow');
            const remainRow = document.getElementById('remainRow');
            const paidEl = document.getElementById('paid');
            const remEl = document.getElementById('remain');
            const changeEl = document.getElementById('change');
            const changeRow = document.getElementById('changeRow');
            const grand = Number(sale.grand_total||0);
            const isMixed = (pay||'')==='mixed';

            const dbPaid = Number(sale.paid_amount||0);
            const dbRemain = Number(sale.remaining_amount||0);

            if(dbPaid > 0 || dbRemain > 0 || sale.payment_status === 'partial'){
              if(dbPaid > 0){ paidEl.innerHTML = fmt(dbPaid); paidRow.style.display=''; } else { try{ paidRow.style.display='none'; }catch(_){} }
              if(dbRemain > 0){ remEl.innerHTML = fmt(dbRemain); remainRow.style.display=''; } else { try{ remainRow.style.display='none'; }catch(_){} }
            } else if(!isMixed){
              let paid = 0, remain = 0, change = 0;
              const entered = Number(cash);
              const pm = (pay||'');
              if(pm === 'cash'){
                if(entered > 0){
                  paid = entered;
                  if(entered >= grand){
                    change = Number((entered - grand).toFixed(2));
                    remain = 0;
                  } else {
                    remain = Number((Math.max(0, grand - entered)).toFixed(2));
                    change = 0;
                  }
                }
              } else if(pm === 'card' || pm === 'tamara' || pm === 'tabby'){
                if(entered > 0){
                  paid = entered;
                  if(entered >= grand){
                    change = Number((entered - grand).toFixed(2));
                    remain = 0;
                  } else {
                    remain = Number((Math.max(0, grand - entered)).toFixed(2));
                    change = 0;
                  }
                } else {
                  paid = grand;
                  remain = 0;
                  change = 0;
                }
              } else {
                paid = 0;
                remain = Number(grand.toFixed(2));
              }
              if(pm === 'credit'){
                paidEl.innerHTML = fmt(0);
                paidRow.style.display='';
                remEl.innerHTML = fmt(grand);
                remainRow.style.display='';
              } else {
                if(remain>0){
                  paidEl.innerHTML = fmt(paid);
                  paidRow.style.display='';
                  remEl.innerHTML = fmt(remain);
                  remainRow.style.display='';
                } else if(change>0){ 
                  changeEl.innerHTML = fmt(change); 
                  changeRow.style.display=''; 
                }
              }
            } else {
              try{
                paidRow.style.display='none';
                remainRow.style.display='none';
                changeRow.style.display='none';
              }catch(_){ }
            }
            // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ù…Ø®ØªÙ„Ø·: Ù†Ù‚Ø¯ÙŠ + Ø´Ø¨ÙƒØ©
            try{
              if(isMixed){
                // Ø­Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©
                let mp = null; try{ mp = window.opener?.__mixed_payment || null; }catch(_){ }
                // Ø¥Ù† Ù„Ù… ØªØªÙˆÙØ±ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø²Ù†Ø©
                if(!mp){
                  const cashSplit = Number(sale.pay_cash_amount||0);
                  const cardSplit = Number(sale.pay_card_amount||0);
                  if(cashSplit>0 || cardSplit>0){ mp = { cash: cashSplit, card: cardSplit }; }
                }
                if(mp){
                  const totals = document.querySelector('.totals tbody');
                  const r1 = document.createElement('tr'); r1.innerHTML = `<td>Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ÙƒØ§Ø´</td><td style=\"text-align:left\">${fmt(mp.cash)}</td>`; totals.insertBefore(r1, document.getElementById('couponRow'));
                  const r2 = document.createElement('tr'); r2.innerHTML = `<td>Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø´Ø¨ÙƒØ©</td><td style=\"text-align:left\">${fmt(mp.card)}</td>`; totals.insertBefore(r2, document.getElementById('couponRow'));
                }
              }
            }catch(_){ }
          }catch(_){ /* ignore */ }

          // show invoice notes if any
          if(sale.notes){
            const n = document.createElement('div');
            n.className = 'muted'; n.style.whiteSpace='pre-wrap'; n.textContent = 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ' + sale.notes;
            document.querySelector('.ticket').appendChild(n);
          }

          // ZATCA QR for thermal as well (offline generation)
          try{
            // Fast path: no VAT â†’ skip QR generation and mark as ready
            try{ if(Number(settings?.vat_percent||0) === 0){ window.__QR_READY = true; window.__NO_VAT_FAST__ = true; } }catch(_){ }
            const qrBox = document.getElementById('qr');
            if(Number(settings?.vat_percent||0) > 0 && settings.seller_legal_name && settings.seller_vat_number){
              function toTLV(tag, value){
                const enc = new TextEncoder(); const valBytes = enc.encode(value||'');
                return [tag, valBytes.length, ...valBytes];
              }
              function genZatcaBase64(seller, vatNo, issueISO, total, vat){
                const parts = [];
                const _seller = String(seller||'');
                const _vat = String(vatNo||'');
                const _iso = String(issueISO||'');
                const _total = (Number(total||0)).toFixed(2);
                const _vatt = (Number(vat||0)).toFixed(2);
                parts.push(...toTLV(1, _seller));
                parts.push(...toTLV(2, _vat));
                parts.push(...toTLV(3, _iso));
                parts.push(...toTLV(4, _total));
                parts.push(...toTLV(5, _vatt));
                const arr = new Uint8Array(parts); let bin='';
                for(let i=0;i<arr.length;i++){ bin += String.fromCharCode(arr[i]); }
                return btoa(bin);
              }
              const issueISO = new Date(sale.created_at).toISOString();
              const b64 = genZatcaBase64(settings.seller_legal_name, settings.seller_vat_number, issueISO, sale.grand_total, sale.vat_total);
              // Try SVG first (crisp for print), then fallback to PNG data URL, then Base64 text
              try{
                const svg = await api.qr_to_svg(b64, { width: 120, margin: 1 });
                if(svg && typeof svg === 'string'){
                  const div = document.createElement('div');
                  div.style.width='120px'; div.style.height='120px';
                  div.innerHTML = svg;
                  qrBox.appendChild(div);
                  window.__QR_READY = true;
                } else {
                  const dataUrl = await api.qr_to_data_url(b64, { errorCorrectionLevel: 'M', width: 120, margin: 1 });
                  if(dataUrl){
                    const img = document.createElement('img'); img.width=120; img.height=120; img.alt='QR';
                    img.src = dataUrl; qrBox.appendChild(img);
                    // image load event will be awaited by main, but mark as ready too
                    img.addEventListener('load', () => { window.__QR_READY = true; }, { once: true });
                  } else {
                    throw new Error('QR generation failed');
                  }
                }
              }catch(e){
                const pre = document.createElement('pre');
                pre.textContent = 'ZATCA QR (Base64):\n' + b64;
                pre.style.fontSize = '10px';
                pre.style.direction = 'ltr';
                qrBox.appendChild(pre);
                window.__QR_READY = true;
              }
            }
          }catch(_){ /* ignore */ }

          const __FAST_NO_VAT__ = Number(settings?.vat_percent||0) === 0;
          
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
          try{
            const errors = [];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            if(!sale.invoice_no || String(sale.invoice_no).trim() === ''){
              errors.push('Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©');
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
            if(!sale.created_at){
              errors.push('Ø§Ù„ØªØ§Ø±ÙŠØ®');
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
            if(!sale.payment_method || String(sale.payment_method).trim() === ''){
              errors.push('Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹');
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª
            if(!items || items.length === 0){
              errors.push('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if(!sale.grand_total || Number(sale.grand_total) <= 0){
              errors.push('Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©ØŒ Ø³Ø¬Ù„ ØªØ­Ø°ÙŠØ± ÙÙ‚Ø· ÙˆÙ„Ø§ ØªÙˆÙ‚Ù Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            if(errors.length > 0){
              false && console.warn('âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:', errors);
            }
          }catch(e){
            false && console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
          }
          
          // Ø¥Ø¹Ù„Ø§Ù… main.js Ø£Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ©
          try{ window.__CONTENT_READY__ = false; }catch(_){ }
          try{
            const __step = () => {
              try{
                const invNoEl = document.getElementById('invNo');
                const invDateEl = document.getElementById('invDate');
                const invPayEl = document.getElementById('invPay');
                const tbody = document.querySelector('table tbody');
                const ok = Boolean(
                  invNoEl && invNoEl.textContent && invNoEl.textContent.trim() &&
                  invDateEl && invDateEl.textContent && invDateEl.textContent.trim() &&
                  invPayEl && invPayEl.textContent && invPayEl.textContent.trim() &&
                  tbody && tbody.children && tbody.children.length > 0
                );
                if(ok){
                  try{ window.__CONTENT_READY__ = true; }catch(_){ }
                  return;
                }
              }catch(_){ }
              setTimeout(() => {
                try{ requestAnimationFrame(__step); }catch(_){ __step(); }
              }, 25);
            };
            requestAnimationFrame(() => {
              requestAnimationFrame(__step);
            });
          }catch(_){ }
          
          // ğŸš€ Ø·Ø¨Ø§Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙÙˆØ± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 800ms)
          const MAX_WAIT = 800;
          const CHECK_INTERVAL = 50;
          const startTime = Date.now();
          
          function checkDataReady(){
            const invNoEl = document.getElementById('invNo');
            const invDateEl = document.getElementById('invDate');
            const invPayEl = document.getElementById('invPay');
            const tbody = document.querySelector('table tbody');
            
            return invNoEl?.textContent?.trim() &&
                   invDateEl?.textContent?.trim() &&
                   invPayEl?.textContent?.trim() &&
                   tbody?.children?.length > 0;
          }
          
          function executePrint(){
            const elapsed = Date.now() - startTime;
            false && console.log(`ğŸ–¨ï¸ [${Date.now()}] Data ready after ${elapsed}ms`);
            
            const invNoEl = document.getElementById('invNo');
            const invDateEl = document.getElementById('invDate');
            const invPayEl = document.getElementById('invPay');
            const tbody = document.querySelector('table tbody');
            
            const domErrors = [];
            if(!invNoEl || !invNoEl.textContent.trim()){
              domErrors.push('Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù… ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
            }
            if(!invDateEl || !invDateEl.textContent.trim()){
              domErrors.push('Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù… ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
            }
            if(!invPayEl || !invPayEl.textContent.trim()){
              domErrors.push('Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù… ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
            }
            if(!tbody || tbody.children.length === 0){
              domErrors.push('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù… ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
            }
            
            if(domErrors.length > 0){
              false && console.error('âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† DOM:', domErrors);
              alert('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:\n' + domErrors.join('\n'));
              return;
            }
            
            if(!(settings && settings.silent_print)){
              false && console.log(`ğŸ–¨ï¸ [${Date.now()}] Calling window.print() now`);
              window.print();
            } else {
              false && console.log(`â­ï¸ [${Date.now()}] Skipping window.print() - silent_print is enabled`);
            }
          }
          
          const checkInterval = setInterval(() => {
            if(checkDataReady()){
              clearInterval(checkInterval);
              requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                  executePrint();
                });
              });
            } else if(Date.now() - startTime >= MAX_WAIT){
              clearInterval(checkInterval);
              false && console.warn(`âš ï¸ [${Date.now()}] Max wait time reached (${MAX_WAIT}ms), printing anyway`);
              requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                  executePrint();
                });
              });
            }
          }, CHECK_INTERVAL);
          
          // Notify opener after printing so kitchen can print next
          try{
            window.addEventListener('afterprint', ()=>{
              false && console.log(`ğŸ“¨ [${Date.now()}] Notifying opener window (this is NOT the WhatsApp handler)`);
              try{ if(window.opener){ window.opener.postMessage({ type:'invoice-after-print' }, '*'); } }catch(_){ }
            });
          }catch(_){ }
        }catch(e){
          document.body.innerHTML = '<div style="padding:12px">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</div>';
        }
      })();
    </script>
  </body>
</html>